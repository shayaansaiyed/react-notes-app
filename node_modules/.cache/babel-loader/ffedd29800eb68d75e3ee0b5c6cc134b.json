{"ast":null,"code":"'use strict';\n\nvar CodeMirror = require('codemirror');\n\nrequire('codemirror/addon/edit/continuelist.js');\n\nrequire('./codemirror/tablist');\n\nrequire('codemirror/addon/display/fullscreen.js');\n\nrequire('codemirror/mode/markdown/markdown.js');\n\nrequire('codemirror/addon/mode/overlay.js');\n\nrequire('codemirror/addon/display/placeholder.js');\n\nrequire('codemirror/addon/selection/mark-selection.js');\n\nrequire('codemirror/addon/search/searchcursor.js');\n\nrequire('codemirror/mode/gfm/gfm.js');\n\nrequire('codemirror/mode/xml/xml.js');\n\nvar CodeMirrorSpellChecker = require('codemirror-spell-checker');\n\nvar marked = require('marked'); // Some variables\n\n\nvar isMac = /Mac/.test(navigator.platform);\nvar anchorToExternalRegex = new RegExp(/(<a.*?https?:\\/\\/.*?[^a]>)+?/g); // Mapping of actions that can be bound to keyboard shortcuts or toolbar buttons\n\nvar bindings = {\n  'toggleBold': toggleBold,\n  'toggleItalic': toggleItalic,\n  'drawLink': drawLink,\n  'toggleHeadingSmaller': toggleHeadingSmaller,\n  'toggleHeadingBigger': toggleHeadingBigger,\n  'drawImage': drawImage,\n  'toggleBlockquote': toggleBlockquote,\n  'toggleOrderedList': toggleOrderedList,\n  'toggleUnorderedList': toggleUnorderedList,\n  'toggleCodeBlock': toggleCodeBlock,\n  'togglePreview': togglePreview,\n  'toggleStrikethrough': toggleStrikethrough,\n  'toggleHeading1': toggleHeading1,\n  'toggleHeading2': toggleHeading2,\n  'toggleHeading3': toggleHeading3,\n  'cleanBlock': cleanBlock,\n  'drawTable': drawTable,\n  'drawHorizontalRule': drawHorizontalRule,\n  'undo': undo,\n  'redo': redo,\n  'toggleSideBySide': toggleSideBySide,\n  'toggleFullScreen': toggleFullScreen\n};\nvar shortcuts = {\n  'toggleBold': 'Cmd-B',\n  'toggleItalic': 'Cmd-I',\n  'drawLink': 'Cmd-K',\n  'toggleHeadingSmaller': 'Cmd-H',\n  'toggleHeadingBigger': 'Shift-Cmd-H',\n  'cleanBlock': 'Cmd-E',\n  'drawImage': 'Cmd-Alt-I',\n  'toggleBlockquote': 'Cmd-\\'',\n  'toggleOrderedList': 'Cmd-Alt-L',\n  'toggleUnorderedList': 'Cmd-L',\n  'toggleCodeBlock': 'Cmd-Alt-C',\n  'togglePreview': 'Cmd-P',\n  'toggleSideBySide': 'F9',\n  'toggleFullScreen': 'F11'\n};\n\nvar getBindingName = function getBindingName(f) {\n  for (var key in bindings) {\n    if (bindings[key] === f) {\n      return key;\n    }\n  }\n\n  return null;\n};\n\nvar isMobile = function isMobile() {\n  var check = false;\n\n  (function (a) {\n    if (/(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw-(n|u)|c55\\/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|g560|gene|gf-5|g-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk\\/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/i.test(a.substr(0, 4))) check = true;\n  })(navigator.userAgent || navigator.vendor || window.opera);\n\n  return check;\n};\n/**\n * Modify HTML to add 'target=\"_blank\"' to links so they open in new tabs by default.\n * @param {string} htmlText - HTML to be modified.\n * @return {string} The modified HTML text.\n */\n\n\nfunction addAnchorTargetBlank(htmlText) {\n  var match;\n\n  while ((match = anchorToExternalRegex.exec(htmlText)) !== null) {\n    // With only one capture group in the RegExp, we can safely take the first index from the match.\n    var linkString = match[0];\n\n    if (linkString.indexOf('target=') === -1) {\n      var fixedLinkString = linkString.replace(/>$/, ' target=\"_blank\">');\n      htmlText = htmlText.replace(linkString, fixedLinkString);\n    }\n  }\n\n  return htmlText;\n}\n/**\n * Fix shortcut. Mac use Command, others use Ctrl.\n */\n\n\nfunction fixShortcut(name) {\n  if (isMac) {\n    name = name.replace('Ctrl', 'Cmd');\n  } else {\n    name = name.replace('Cmd', 'Ctrl');\n  }\n\n  return name;\n}\n/**\n * Create button element for toolbar.\n */\n\n\nfunction createToolbarButton(options, enableTooltips, shortcuts) {\n  options = options || {};\n  var el = document.createElement('button');\n  el.className = options.name;\n  el.setAttribute('type', 'button');\n  enableTooltips = enableTooltips == undefined ? true : enableTooltips; // Properly hande custom shortcuts\n\n  if (options.name && options.name in shortcuts) {\n    bindings[options.name] = options.action;\n  }\n\n  if (options.title && enableTooltips) {\n    el.title = createTooltip(options.title, options.action, shortcuts);\n\n    if (isMac) {\n      el.title = el.title.replace('Ctrl', '⌘');\n      el.title = el.title.replace('Alt', '⌥');\n    }\n  }\n\n  if (options.noDisable) {\n    el.classList.add('no-disable');\n  }\n\n  if (options.noMobile) {\n    el.classList.add('no-mobile');\n  } // Provide backwards compatibility with simple-markdown-editor by adding custom classes to the button.\n\n\n  var classNameParts = options.className.split(' ');\n  var iconClasses = [];\n\n  for (var classNameIndex = 0; classNameIndex < classNameParts.length; classNameIndex++) {\n    var classNamePart = classNameParts[classNameIndex]; // Split icon classes from the button.\n    // Regex will detect \"fa\", \"fas\", \"fa-something\" and \"fa-some-icon-1\", but not \"fanfare\".\n\n    if (classNamePart.match(/^fa([srlb]|(-[\\w-]*)|$)/)) {\n      iconClasses.push(classNamePart);\n    } else {\n      el.classList.add(classNamePart);\n    }\n  }\n\n  el.tabIndex = -1; // Create icon element and append as a child to the button\n\n  var icon = document.createElement('i');\n\n  for (var iconClassIndex = 0; iconClassIndex < iconClasses.length; iconClassIndex++) {\n    var iconClass = iconClasses[iconClassIndex];\n    icon.classList.add(iconClass);\n  }\n\n  el.appendChild(icon);\n  return el;\n}\n\nfunction createSep() {\n  var el = document.createElement('i');\n  el.className = 'separator';\n  el.innerHTML = '|';\n  return el;\n}\n\nfunction createTooltip(title, action, shortcuts) {\n  var actionName;\n  var tooltip = title;\n\n  if (action) {\n    actionName = getBindingName(action);\n\n    if (shortcuts[actionName]) {\n      tooltip += ' (' + fixShortcut(shortcuts[actionName]) + ')';\n    }\n  }\n\n  return tooltip;\n}\n/**\n * The state of CodeMirror at the given position.\n */\n\n\nfunction getState(cm, pos) {\n  pos = pos || cm.getCursor('start');\n  var stat = cm.getTokenAt(pos);\n  if (!stat.type) return {};\n  var types = stat.type.split(' ');\n  var ret = {},\n      data,\n      text;\n\n  for (var i = 0; i < types.length; i++) {\n    data = types[i];\n\n    if (data === 'strong') {\n      ret.bold = true;\n    } else if (data === 'variable-2') {\n      text = cm.getLine(pos.line);\n\n      if (/^\\s*\\d+\\.\\s/.test(text)) {\n        ret['ordered-list'] = true;\n      } else {\n        ret['unordered-list'] = true;\n      }\n    } else if (data === 'atom') {\n      ret.quote = true;\n    } else if (data === 'em') {\n      ret.italic = true;\n    } else if (data === 'quote') {\n      ret.quote = true;\n    } else if (data === 'strikethrough') {\n      ret.strikethrough = true;\n    } else if (data === 'comment') {\n      ret.code = true;\n    } else if (data === 'link') {\n      ret.link = true;\n    } else if (data === 'tag') {\n      ret.image = true;\n    } else if (data.match(/^header(-[1-6])?$/)) {\n      ret[data.replace('header', 'heading')] = true;\n    }\n  }\n\n  return ret;\n} // Saved overflow setting\n\n\nvar saved_overflow = '';\n/**\n * Toggle full screen of the editor.\n */\n\nfunction toggleFullScreen(editor) {\n  // Set fullscreen\n  var cm = editor.codemirror;\n  cm.setOption('fullScreen', !cm.getOption('fullScreen')); // Prevent scrolling on body during fullscreen active\n\n  if (cm.getOption('fullScreen')) {\n    saved_overflow = document.body.style.overflow;\n    document.body.style.overflow = 'hidden';\n  } else {\n    document.body.style.overflow = saved_overflow;\n  } // Update toolbar class\n\n\n  var wrap = cm.getWrapperElement();\n\n  if (!/fullscreen/.test(wrap.previousSibling.className)) {\n    wrap.previousSibling.className += ' fullscreen';\n  } else {\n    wrap.previousSibling.className = wrap.previousSibling.className.replace(/\\s*fullscreen\\b/, '');\n  } // Update toolbar button\n\n\n  if (editor.toolbarElements && editor.toolbarElements.fullscreen) {\n    var toolbarButton = editor.toolbarElements.fullscreen;\n\n    if (!/active/.test(toolbarButton.className)) {\n      toolbarButton.className += ' active';\n    } else {\n      toolbarButton.className = toolbarButton.className.replace(/\\s*active\\s*/g, '');\n    }\n  } // Hide side by side if needed\n\n\n  var sidebyside = cm.getWrapperElement().nextSibling;\n  if (/editor-preview-active-side/.test(sidebyside.className)) toggleSideBySide(editor);\n\n  if (editor.options.onToggleFullScreen) {\n    editor.options.onToggleFullScreen(cm.getOption('fullScreen') || false);\n  }\n}\n/**\n * Action for toggling bold.\n */\n\n\nfunction toggleBold(editor) {\n  _toggleBlock(editor, 'bold', editor.options.blockStyles.bold);\n}\n/**\n * Action for toggling italic.\n */\n\n\nfunction toggleItalic(editor) {\n  _toggleBlock(editor, 'italic', editor.options.blockStyles.italic);\n}\n/**\n * Action for toggling strikethrough.\n */\n\n\nfunction toggleStrikethrough(editor) {\n  _toggleBlock(editor, 'strikethrough', '~~');\n}\n/**\n * Action for toggling code block.\n */\n\n\nfunction toggleCodeBlock(editor) {\n  var fenceCharsToInsert = editor.options.blockStyles.code;\n\n  function fencing_line(line) {\n    /* return true, if this is a ``` or ~~~ line */\n    if (typeof line !== 'object') {\n      throw 'fencing_line() takes a \\'line\\' object (not a line number, or line text).  Got: ' + typeof line + ': ' + line;\n    }\n\n    return line.styles && line.styles[2] && line.styles[2].indexOf('formatting-code-block') !== -1;\n  }\n\n  function token_state(token) {\n    // base goes an extra level deep when mode backdrops are used, e.g. spellchecker on\n    return token.state.base.base || token.state.base;\n  }\n\n  function code_type(cm, line_num, line, firstTok, lastTok) {\n    /*\n     * Return \"single\", \"indented\", \"fenced\" or false\n     *\n     * cm and line_num are required.  Others are optional for efficiency\n     *   To check in the middle of a line, pass in firstTok yourself.\n     */\n    line = line || cm.getLineHandle(line_num);\n    firstTok = firstTok || cm.getTokenAt({\n      line: line_num,\n      ch: 1\n    });\n    lastTok = lastTok || !!line.text && cm.getTokenAt({\n      line: line_num,\n      ch: line.text.length - 1\n    });\n    var types = firstTok.type ? firstTok.type.split(' ') : [];\n\n    if (lastTok && token_state(lastTok).indentedCode) {\n      // have to check last char, since first chars of first line aren\"t marked as indented\n      return 'indented';\n    } else if (types.indexOf('comment') === -1) {\n      // has to be after \"indented\" check, since first chars of first indented line aren\"t marked as such\n      return false;\n    } else if (token_state(firstTok).fencedChars || token_state(lastTok).fencedChars || fencing_line(line)) {\n      return 'fenced';\n    } else {\n      return 'single';\n    }\n  }\n\n  function insertFencingAtSelection(cm, cur_start, cur_end, fenceCharsToInsert) {\n    var start_line_sel = cur_start.line + 1,\n        end_line_sel = cur_end.line + 1,\n        sel_multi = cur_start.line !== cur_end.line,\n        repl_start = fenceCharsToInsert + '\\n',\n        repl_end = '\\n' + fenceCharsToInsert;\n\n    if (sel_multi) {\n      end_line_sel++;\n    } // handle last char including \\n or not\n\n\n    if (sel_multi && cur_end.ch === 0) {\n      repl_end = fenceCharsToInsert + '\\n';\n      end_line_sel--;\n    }\n\n    _replaceSelection(cm, false, [repl_start, repl_end]);\n\n    cm.setSelection({\n      line: start_line_sel,\n      ch: 0\n    }, {\n      line: end_line_sel,\n      ch: 0\n    });\n  }\n\n  var cm = editor.codemirror,\n      cur_start = cm.getCursor('start'),\n      cur_end = cm.getCursor('end'),\n      tok = cm.getTokenAt({\n    line: cur_start.line,\n    ch: cur_start.ch || 1\n  }),\n      // avoid ch 0 which is a cursor pos but not token\n  line = cm.getLineHandle(cur_start.line),\n      is_code = code_type(cm, cur_start.line, line, tok);\n  var block_start, block_end, lineCount;\n\n  if (is_code === 'single') {\n    // similar to some EasyMDE _toggleBlock logic\n    var start = line.text.slice(0, cur_start.ch).replace('`', ''),\n        end = line.text.slice(cur_start.ch).replace('`', '');\n    cm.replaceRange(start + end, {\n      line: cur_start.line,\n      ch: 0\n    }, {\n      line: cur_start.line,\n      ch: 99999999999999\n    });\n    cur_start.ch--;\n\n    if (cur_start !== cur_end) {\n      cur_end.ch--;\n    }\n\n    cm.setSelection(cur_start, cur_end);\n    cm.focus();\n  } else if (is_code === 'fenced') {\n    if (cur_start.line !== cur_end.line || cur_start.ch !== cur_end.ch) {\n      // use selection\n      // find the fenced line so we know what type it is (tilde, backticks, number of them)\n      for (block_start = cur_start.line; block_start >= 0; block_start--) {\n        line = cm.getLineHandle(block_start);\n\n        if (fencing_line(line)) {\n          break;\n        }\n      }\n\n      var fencedTok = cm.getTokenAt({\n        line: block_start,\n        ch: 1\n      });\n      var fence_chars = token_state(fencedTok).fencedChars;\n      var start_text, start_line;\n      var end_text, end_line; // check for selection going up against fenced lines, in which case we don't want to add more fencing\n\n      if (fencing_line(cm.getLineHandle(cur_start.line))) {\n        start_text = '';\n        start_line = cur_start.line;\n      } else if (fencing_line(cm.getLineHandle(cur_start.line - 1))) {\n        start_text = '';\n        start_line = cur_start.line - 1;\n      } else {\n        start_text = fence_chars + '\\n';\n        start_line = cur_start.line;\n      }\n\n      if (fencing_line(cm.getLineHandle(cur_end.line))) {\n        end_text = '';\n        end_line = cur_end.line;\n\n        if (cur_end.ch === 0) {\n          end_line += 1;\n        }\n      } else if (cur_end.ch !== 0 && fencing_line(cm.getLineHandle(cur_end.line + 1))) {\n        end_text = '';\n        end_line = cur_end.line + 1;\n      } else {\n        end_text = fence_chars + '\\n';\n        end_line = cur_end.line + 1;\n      }\n\n      if (cur_end.ch === 0) {\n        // full last line selected, putting cursor at beginning of next\n        end_line -= 1;\n      }\n\n      cm.operation(function () {\n        // end line first, so that line numbers don't change\n        cm.replaceRange(end_text, {\n          line: end_line,\n          ch: 0\n        }, {\n          line: end_line + (end_text ? 0 : 1),\n          ch: 0\n        });\n        cm.replaceRange(start_text, {\n          line: start_line,\n          ch: 0\n        }, {\n          line: start_line + (start_text ? 0 : 1),\n          ch: 0\n        });\n      });\n      cm.setSelection({\n        line: start_line + (start_text ? 1 : 0),\n        ch: 0\n      }, {\n        line: end_line + (start_text ? 1 : -1),\n        ch: 0\n      });\n      cm.focus();\n    } else {\n      // no selection, search for ends of this fenced block\n      var search_from = cur_start.line;\n\n      if (fencing_line(cm.getLineHandle(cur_start.line))) {\n        // gets a little tricky if cursor is right on a fenced line\n        if (code_type(cm, cur_start.line + 1) === 'fenced') {\n          block_start = cur_start.line;\n          search_from = cur_start.line + 1; // for searching for \"end\"\n        } else {\n          block_end = cur_start.line;\n          search_from = cur_start.line - 1; // for searching for \"start\"\n        }\n      }\n\n      if (block_start === undefined) {\n        for (block_start = search_from; block_start >= 0; block_start--) {\n          line = cm.getLineHandle(block_start);\n\n          if (fencing_line(line)) {\n            break;\n          }\n        }\n      }\n\n      if (block_end === undefined) {\n        lineCount = cm.lineCount();\n\n        for (block_end = search_from; block_end < lineCount; block_end++) {\n          line = cm.getLineHandle(block_end);\n\n          if (fencing_line(line)) {\n            break;\n          }\n        }\n      }\n\n      cm.operation(function () {\n        cm.replaceRange('', {\n          line: block_start,\n          ch: 0\n        }, {\n          line: block_start + 1,\n          ch: 0\n        });\n        cm.replaceRange('', {\n          line: block_end - 1,\n          ch: 0\n        }, {\n          line: block_end,\n          ch: 0\n        });\n      });\n      cm.focus();\n    }\n  } else if (is_code === 'indented') {\n    if (cur_start.line !== cur_end.line || cur_start.ch !== cur_end.ch) {\n      // use selection\n      block_start = cur_start.line;\n      block_end = cur_end.line;\n\n      if (cur_end.ch === 0) {\n        block_end--;\n      }\n    } else {\n      // no selection, search for ends of this indented block\n      for (block_start = cur_start.line; block_start >= 0; block_start--) {\n        line = cm.getLineHandle(block_start);\n\n        if (line.text.match(/^\\s*$/)) {\n          // empty or all whitespace - keep going\n          continue;\n        } else {\n          if (code_type(cm, block_start, line) !== 'indented') {\n            block_start += 1;\n            break;\n          }\n        }\n      }\n\n      lineCount = cm.lineCount();\n\n      for (block_end = cur_start.line; block_end < lineCount; block_end++) {\n        line = cm.getLineHandle(block_end);\n\n        if (line.text.match(/^\\s*$/)) {\n          // empty or all whitespace - keep going\n          continue;\n        } else {\n          if (code_type(cm, block_end, line) !== 'indented') {\n            block_end -= 1;\n            break;\n          }\n        }\n      }\n    } // if we are going to un-indent based on a selected set of lines, and the next line is indented too, we need to\n    // insert a blank line so that the next line(s) continue to be indented code\n\n\n    var next_line = cm.getLineHandle(block_end + 1),\n        next_line_last_tok = next_line && cm.getTokenAt({\n      line: block_end + 1,\n      ch: next_line.text.length - 1\n    }),\n        next_line_indented = next_line_last_tok && token_state(next_line_last_tok).indentedCode;\n\n    if (next_line_indented) {\n      cm.replaceRange('\\n', {\n        line: block_end + 1,\n        ch: 0\n      });\n    }\n\n    for (var i = block_start; i <= block_end; i++) {\n      cm.indentLine(i, 'subtract'); // TODO: this doesn't get tracked in the history, so can't be undone :(\n    }\n\n    cm.focus();\n  } else {\n    // insert code formatting\n    var no_sel_and_starting_of_line = cur_start.line === cur_end.line && cur_start.ch === cur_end.ch && cur_start.ch === 0;\n    var sel_multi = cur_start.line !== cur_end.line;\n\n    if (no_sel_and_starting_of_line || sel_multi) {\n      insertFencingAtSelection(cm, cur_start, cur_end, fenceCharsToInsert);\n    } else {\n      _replaceSelection(cm, false, ['`', '`']);\n    }\n  }\n}\n/**\n * Action for toggling blockquote.\n */\n\n\nfunction toggleBlockquote(editor) {\n  var cm = editor.codemirror;\n\n  _toggleLine(cm, 'quote');\n}\n/**\n * Action for toggling heading size: normal -> h1 -> h2 -> h3 -> h4 -> h5 -> h6 -> normal\n */\n\n\nfunction toggleHeadingSmaller(editor) {\n  var cm = editor.codemirror;\n\n  _toggleHeading(cm, 'smaller');\n}\n/**\n * Action for toggling heading size: normal -> h6 -> h5 -> h4 -> h3 -> h2 -> h1 -> normal\n */\n\n\nfunction toggleHeadingBigger(editor) {\n  var cm = editor.codemirror;\n\n  _toggleHeading(cm, 'bigger');\n}\n/**\n * Action for toggling heading size 1\n */\n\n\nfunction toggleHeading1(editor) {\n  var cm = editor.codemirror;\n\n  _toggleHeading(cm, undefined, 1);\n}\n/**\n * Action for toggling heading size 2\n */\n\n\nfunction toggleHeading2(editor) {\n  var cm = editor.codemirror;\n\n  _toggleHeading(cm, undefined, 2);\n}\n/**\n * Action for toggling heading size 3\n */\n\n\nfunction toggleHeading3(editor) {\n  var cm = editor.codemirror;\n\n  _toggleHeading(cm, undefined, 3);\n}\n/**\n * Action for toggling ul.\n */\n\n\nfunction toggleUnorderedList(editor) {\n  var cm = editor.codemirror;\n\n  _toggleLine(cm, 'unordered-list');\n}\n/**\n * Action for toggling ol.\n */\n\n\nfunction toggleOrderedList(editor) {\n  var cm = editor.codemirror;\n\n  _toggleLine(cm, 'ordered-list');\n}\n/**\n * Action for clean block (remove headline, list, blockquote code, markers)\n */\n\n\nfunction cleanBlock(editor) {\n  var cm = editor.codemirror;\n\n  _cleanBlock(cm);\n}\n/**\n * Action for drawing a link.\n */\n\n\nfunction drawLink(editor) {\n  var cm = editor.codemirror;\n  var stat = getState(cm);\n  var options = editor.options;\n  var url = 'https://';\n\n  if (options.promptURLs) {\n    url = prompt(options.promptTexts.link, 'https://');\n\n    if (!url) {\n      return false;\n    }\n  }\n\n  _replaceSelection(cm, stat.link, options.insertTexts.link, url);\n}\n/**\n * Action for drawing an img.\n */\n\n\nfunction drawImage(editor) {\n  var cm = editor.codemirror;\n  var stat = getState(cm);\n  var options = editor.options;\n  var url = 'https://';\n\n  if (options.promptURLs) {\n    url = prompt(options.promptTexts.image, 'https://');\n\n    if (!url) {\n      return false;\n    }\n  }\n\n  _replaceSelection(cm, stat.image, options.insertTexts.image, url);\n}\n/**\n * Action for opening the browse-file window to upload an image to a server.\n * @param editor {EasyMDE} The EasyMDE object\n */\n\n\nfunction drawUploadedImage(editor) {\n  // TODO: Draw the image template with a fake url? ie: '![](importing foo.png...)'\n  editor.openBrowseFileWindow();\n}\n/**\n * Action executed after an image have been successfully imported on the server.\n * @param editor {EasyMDE} The EasyMDE object\n * @param url {string} The url of the uploaded image\n */\n\n\nfunction afterImageUploaded(editor, url) {\n  var cm = editor.codemirror;\n  var stat = getState(cm);\n  var options = editor.options;\n  var imageName = url.substr(url.lastIndexOf('/') + 1);\n\n  _replaceSelection(cm, stat.image, options.insertTexts.uploadedImage, url); // show uploaded image filename for 1000ms\n\n\n  editor.updateStatusBar('upload-image', editor.options.imageTexts.sbOnUploaded.replace('#image_name#', imageName));\n  setTimeout(function () {\n    editor.updateStatusBar('upload-image', editor.options.imageTexts.sbInit);\n  }, 1000);\n}\n/**\n * Action for drawing a table.\n */\n\n\nfunction drawTable(editor) {\n  var cm = editor.codemirror;\n  var stat = getState(cm);\n  var options = editor.options;\n\n  _replaceSelection(cm, stat.table, options.insertTexts.table);\n}\n/**\n * Action for drawing a horizontal rule.\n */\n\n\nfunction drawHorizontalRule(editor) {\n  var cm = editor.codemirror;\n  var stat = getState(cm);\n  var options = editor.options;\n\n  _replaceSelection(cm, stat.image, options.insertTexts.horizontalRule);\n}\n/**\n * Undo action.\n */\n\n\nfunction undo(editor) {\n  var cm = editor.codemirror;\n  cm.undo();\n  cm.focus();\n}\n/**\n * Redo action.\n */\n\n\nfunction redo(editor) {\n  var cm = editor.codemirror;\n  cm.redo();\n  cm.focus();\n}\n/**\n * Toggle side by side preview\n */\n\n\nfunction toggleSideBySide(editor) {\n  var cm = editor.codemirror;\n  var wrapper = cm.getWrapperElement();\n  var preview = wrapper.nextSibling;\n  var toolbarButton = editor.toolbarElements && editor.toolbarElements['side-by-side'];\n  var useSideBySideListener = false;\n\n  if (/editor-preview-active-side/.test(preview.className)) {\n    preview.className = preview.className.replace(/\\s*editor-preview-active-side\\s*/g, '');\n    if (toolbarButton) toolbarButton.className = toolbarButton.className.replace(/\\s*active\\s*/g, '');\n    wrapper.className = wrapper.className.replace(/\\s*CodeMirror-sided\\s*/g, ' ');\n  } else {\n    // When the preview button is clicked for the first time,\n    // give some time for the transition from editor.css to fire and the view to slide from right to left,\n    // instead of just appearing.\n    setTimeout(function () {\n      if (!cm.getOption('fullScreen')) toggleFullScreen(editor);\n      preview.className += ' editor-preview-active-side';\n    }, 1);\n    if (toolbarButton) toolbarButton.className += ' active';\n    wrapper.className += ' CodeMirror-sided';\n    useSideBySideListener = true;\n  } // Hide normal preview if active\n\n\n  var previewNormal = wrapper.lastChild;\n\n  if (/editor-preview-active/.test(previewNormal.className)) {\n    previewNormal.className = previewNormal.className.replace(/\\s*editor-preview-active\\s*/g, '');\n    var toolbar = editor.toolbarElements.preview;\n    var toolbar_div = wrapper.previousSibling;\n    toolbar.className = toolbar.className.replace(/\\s*active\\s*/g, '');\n    toolbar_div.className = toolbar_div.className.replace(/\\s*disabled-for-preview*/g, '');\n  }\n\n  var sideBySideRenderingFunction = function sideBySideRenderingFunction() {\n    var newValue = editor.options.previewRender(editor.value(), preview);\n\n    if (newValue != null) {\n      preview.innerHTML = newValue;\n    }\n  };\n\n  if (!cm.sideBySideRenderingFunction) {\n    cm.sideBySideRenderingFunction = sideBySideRenderingFunction;\n  }\n\n  if (useSideBySideListener) {\n    var newValue = editor.options.previewRender(editor.value(), preview);\n\n    if (newValue != null) {\n      preview.innerHTML = newValue;\n    }\n\n    cm.on('update', cm.sideBySideRenderingFunction);\n  } else {\n    cm.off('update', cm.sideBySideRenderingFunction);\n  } // Refresh to fix selection being off (#309)\n\n\n  cm.refresh();\n}\n/**\n * Preview action.\n */\n\n\nfunction togglePreview(editor) {\n  var cm = editor.codemirror;\n  var wrapper = cm.getWrapperElement();\n  var toolbar_div = wrapper.previousSibling;\n  var toolbar = editor.options.toolbar ? editor.toolbarElements.preview : false;\n  var preview = wrapper.lastChild;\n\n  if (!preview || !/editor-preview-full/.test(preview.className)) {\n    preview = document.createElement('div');\n    preview.className = 'editor-preview-full';\n\n    if (editor.options.previewClass) {\n      if (Array.isArray(editor.options.previewClass)) {\n        for (var i = 0; i < editor.options.previewClass.length; i++) {\n          preview.className += ' ' + editor.options.previewClass[i];\n        }\n      } else if (typeof editor.options.previewClass === 'string') {\n        preview.className += ' ' + editor.options.previewClass;\n      }\n    }\n\n    wrapper.appendChild(preview);\n  }\n\n  if (/editor-preview-active/.test(preview.className)) {\n    preview.className = preview.className.replace(/\\s*editor-preview-active\\s*/g, '');\n\n    if (toolbar) {\n      toolbar.className = toolbar.className.replace(/\\s*active\\s*/g, '');\n      toolbar_div.className = toolbar_div.className.replace(/\\s*disabled-for-preview*/g, '');\n    }\n  } else {\n    // When the preview button is clicked for the first time,\n    // give some time for the transition from editor.css to fire and the view to slide from right to left,\n    // instead of just appearing.\n    setTimeout(function () {\n      preview.className += ' editor-preview-active';\n    }, 1);\n\n    if (toolbar) {\n      toolbar.className += ' active';\n      toolbar_div.className += ' disabled-for-preview';\n    }\n  }\n\n  preview.innerHTML = editor.options.previewRender(editor.value(), preview); // Turn off side by side if needed\n\n  var sidebyside = cm.getWrapperElement().nextSibling;\n  if (/editor-preview-active-side/.test(sidebyside.className)) toggleSideBySide(editor);\n}\n\nfunction _replaceSelection(cm, active, startEnd, url) {\n  if (/editor-preview-active/.test(cm.getWrapperElement().lastChild.className)) return;\n  var text;\n  var start = startEnd[0];\n  var end = startEnd[1];\n  var startPoint = {},\n      endPoint = {};\n  Object.assign(startPoint, cm.getCursor('start'));\n  Object.assign(endPoint, cm.getCursor('end'));\n\n  if (url) {\n    start = start.replace('#url#', url); // url is in start for upload-image\n\n    end = end.replace('#url#', url);\n  }\n\n  if (active) {\n    text = cm.getLine(startPoint.line);\n    start = text.slice(0, startPoint.ch);\n    end = text.slice(startPoint.ch);\n    cm.replaceRange(start + end, {\n      line: startPoint.line,\n      ch: 0\n    });\n  } else {\n    text = cm.getSelection();\n    cm.replaceSelection(start + text + end);\n    startPoint.ch += start.length;\n\n    if (startPoint !== endPoint) {\n      endPoint.ch += start.length;\n    }\n  }\n\n  cm.setSelection(startPoint, endPoint);\n  cm.focus();\n}\n\nfunction _toggleHeading(cm, direction, size) {\n  if (/editor-preview-active/.test(cm.getWrapperElement().lastChild.className)) return;\n  var startPoint = cm.getCursor('start');\n  var endPoint = cm.getCursor('end');\n\n  for (var i = startPoint.line; i <= endPoint.line; i++) {\n    (function (i) {\n      var text = cm.getLine(i);\n      var currHeadingLevel = text.search(/[^#]/);\n\n      if (direction !== undefined) {\n        if (currHeadingLevel <= 0) {\n          if (direction == 'bigger') {\n            text = '###### ' + text;\n          } else {\n            text = '# ' + text;\n          }\n        } else if (currHeadingLevel == 6 && direction == 'smaller') {\n          text = text.substr(7);\n        } else if (currHeadingLevel == 1 && direction == 'bigger') {\n          text = text.substr(2);\n        } else {\n          if (direction == 'bigger') {\n            text = text.substr(1);\n          } else {\n            text = '#' + text;\n          }\n        }\n      } else {\n        if (size == 1) {\n          if (currHeadingLevel <= 0) {\n            text = '# ' + text;\n          } else if (currHeadingLevel == size) {\n            text = text.substr(currHeadingLevel + 1);\n          } else {\n            text = '# ' + text.substr(currHeadingLevel + 1);\n          }\n        } else if (size == 2) {\n          if (currHeadingLevel <= 0) {\n            text = '## ' + text;\n          } else if (currHeadingLevel == size) {\n            text = text.substr(currHeadingLevel + 1);\n          } else {\n            text = '## ' + text.substr(currHeadingLevel + 1);\n          }\n        } else {\n          if (currHeadingLevel <= 0) {\n            text = '### ' + text;\n          } else if (currHeadingLevel == size) {\n            text = text.substr(currHeadingLevel + 1);\n          } else {\n            text = '### ' + text.substr(currHeadingLevel + 1);\n          }\n        }\n      }\n\n      cm.replaceRange(text, {\n        line: i,\n        ch: 0\n      }, {\n        line: i,\n        ch: 99999999999999\n      });\n    })(i);\n  }\n\n  cm.focus();\n}\n\nfunction _toggleLine(cm, name) {\n  if (/editor-preview-active/.test(cm.getWrapperElement().lastChild.className)) return;\n  var listRegexp = /^(\\s*)(\\*|-|\\+|\\d*\\.)(\\s+)/;\n  var whitespacesRegexp = /^\\s*/;\n  var stat = getState(cm);\n  var startPoint = cm.getCursor('start');\n  var endPoint = cm.getCursor('end');\n  var repl = {\n    'quote': /^(\\s*)>\\s+/,\n    'unordered-list': listRegexp,\n    'ordered-list': listRegexp\n  };\n\n  var _getChar = function _getChar(name, i) {\n    var map = {\n      'quote': '>',\n      'unordered-list': '*',\n      'ordered-list': '%%i.'\n    };\n    return map[name].replace('%%i', i);\n  };\n\n  var _checkChar = function _checkChar(name, char) {\n    var map = {\n      'quote': '>',\n      'unordered-list': '*',\n      'ordered-list': '\\\\d+.'\n    };\n    var rt = new RegExp(map[name]);\n    return char && rt.test(char);\n  };\n\n  var _toggle = function _toggle(name, text, untoggleOnly) {\n    var arr = listRegexp.exec(text);\n\n    var char = _getChar(name, line);\n\n    if (arr !== null) {\n      if (_checkChar(name, arr[2])) {\n        char = '';\n      }\n\n      text = arr[1] + char + arr[3] + text.replace(whitespacesRegexp, '').replace(repl[name], '$1');\n    } else if (untoggleOnly == false) {\n      text = char + ' ' + text;\n    }\n\n    return text;\n  };\n\n  var line = 1;\n\n  for (var i = startPoint.line; i <= endPoint.line; i++) {\n    (function (i) {\n      var text = cm.getLine(i);\n\n      if (stat[name]) {\n        text = text.replace(repl[name], '$1');\n      } else {\n        // If we're toggling unordered-list formatting, check if the current line\n        // is part of an ordered-list, and if so, untoggle that first.\n        // Workaround for https://github.com/Ionaru/easy-markdown-editor/issues/92\n        if (name == 'unordered-list') {\n          text = _toggle('ordered-list', text, true);\n        }\n\n        text = _toggle(name, text, false);\n        line += 1;\n      }\n\n      cm.replaceRange(text, {\n        line: i,\n        ch: 0\n      }, {\n        line: i,\n        ch: 99999999999999\n      });\n    })(i);\n  }\n\n  cm.focus();\n}\n\nfunction _toggleBlock(editor, type, start_chars, end_chars) {\n  if (/editor-preview-active/.test(editor.codemirror.getWrapperElement().lastChild.className)) return;\n  end_chars = typeof end_chars === 'undefined' ? start_chars : end_chars;\n  var cm = editor.codemirror;\n  var stat = getState(cm);\n  var text;\n  var start = start_chars;\n  var end = end_chars;\n  var startPoint = cm.getCursor('start');\n  var endPoint = cm.getCursor('end');\n\n  if (stat[type]) {\n    text = cm.getLine(startPoint.line);\n    start = text.slice(0, startPoint.ch);\n    end = text.slice(startPoint.ch);\n\n    if (type == 'bold') {\n      start = start.replace(/(\\*\\*|__)(?![\\s\\S]*(\\*\\*|__))/, '');\n      end = end.replace(/(\\*\\*|__)/, '');\n    } else if (type == 'italic') {\n      start = start.replace(/(\\*|_)(?![\\s\\S]*(\\*|_))/, '');\n      end = end.replace(/(\\*|_)/, '');\n    } else if (type == 'strikethrough') {\n      start = start.replace(/(\\*\\*|~~)(?![\\s\\S]*(\\*\\*|~~))/, '');\n      end = end.replace(/(\\*\\*|~~)/, '');\n    }\n\n    cm.replaceRange(start + end, {\n      line: startPoint.line,\n      ch: 0\n    }, {\n      line: startPoint.line,\n      ch: 99999999999999\n    });\n\n    if (type == 'bold' || type == 'strikethrough') {\n      startPoint.ch -= 2;\n\n      if (startPoint !== endPoint) {\n        endPoint.ch -= 2;\n      }\n    } else if (type == 'italic') {\n      startPoint.ch -= 1;\n\n      if (startPoint !== endPoint) {\n        endPoint.ch -= 1;\n      }\n    }\n  } else {\n    text = cm.getSelection();\n\n    if (type == 'bold') {\n      text = text.split('**').join('');\n      text = text.split('__').join('');\n    } else if (type == 'italic') {\n      text = text.split('*').join('');\n      text = text.split('_').join('');\n    } else if (type == 'strikethrough') {\n      text = text.split('~~').join('');\n    }\n\n    cm.replaceSelection(start + text + end);\n    startPoint.ch += start_chars.length;\n    endPoint.ch = startPoint.ch + text.length;\n  }\n\n  cm.setSelection(startPoint, endPoint);\n  cm.focus();\n}\n\nfunction _cleanBlock(cm) {\n  if (/editor-preview-active/.test(cm.getWrapperElement().lastChild.className)) return;\n  var startPoint = cm.getCursor('start');\n  var endPoint = cm.getCursor('end');\n  var text;\n\n  for (var line = startPoint.line; line <= endPoint.line; line++) {\n    text = cm.getLine(line);\n    text = text.replace(/^[ ]*([# ]+|\\*|-|[> ]+|[0-9]+(.|\\)))[ ]*/, '');\n    cm.replaceRange(text, {\n      line: line,\n      ch: 0\n    }, {\n      line: line,\n      ch: 99999999999999\n    });\n  }\n}\n/**\n * Convert a number of bytes to a human-readable file size.\n * @param bytes {integer} A number of bytes, as integer. Ex: 421137\n * @param units {number[]} An array of human-readable units, ie. ['b', 'Kb', 'Mb']\n * @returns string A human-readable file size. Ex: '412Kb'\n */\n\n\nfunction humanFileSize(bytes, units) {\n  if (Math.abs(bytes) < 1024) {\n    return '' + bytes + units[0];\n  }\n\n  var u = 0;\n\n  do {\n    bytes /= 1024;\n    ++u;\n  } while (Math.abs(bytes) >= 1024 && u < units.length);\n\n  return '' + bytes.toFixed(1) + units[u];\n} // Merge the properties of one object into another.\n\n\nfunction _mergeProperties(target, source) {\n  for (var property in source) {\n    if (Object.prototype.hasOwnProperty.call(source, property)) {\n      if (source[property] instanceof Array) {\n        target[property] = source[property].concat(target[property] instanceof Array ? target[property] : []);\n      } else if (source[property] !== null && typeof source[property] === 'object' && source[property].constructor === Object) {\n        target[property] = _mergeProperties(target[property] || {}, source[property]);\n      } else {\n        target[property] = source[property];\n      }\n    }\n  }\n\n  return target;\n} // Merge an arbitrary number of objects into one.\n\n\nfunction extend(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    target = _mergeProperties(target, arguments[i]);\n  }\n\n  return target;\n}\n/* The right word count in respect for CJK. */\n\n\nfunction wordCount(data) {\n  var pattern = /[a-zA-Z0-9_\\u00A0-\\u02AF\\u0392-\\u03c9\\u0410-\\u04F9]+|[\\u4E00-\\u9FFF\\u3400-\\u4dbf\\uf900-\\ufaff\\u3040-\\u309f\\uac00-\\ud7af]+/g;\n  var m = data.match(pattern);\n  var count = 0;\n  if (m === null) return count;\n\n  for (var i = 0; i < m.length; i++) {\n    if (m[i].charCodeAt(0) >= 0x4E00) {\n      count += m[i].length;\n    } else {\n      count += 1;\n    }\n  }\n\n  return count;\n}\n\nvar toolbarBuiltInButtons = {\n  'bold': {\n    name: 'bold',\n    action: toggleBold,\n    className: 'fa fa-bold',\n    title: 'Bold',\n    default: true\n  },\n  'italic': {\n    name: 'italic',\n    action: toggleItalic,\n    className: 'fa fa-italic',\n    title: 'Italic',\n    default: true\n  },\n  'strikethrough': {\n    name: 'strikethrough',\n    action: toggleStrikethrough,\n    className: 'fa fa-strikethrough',\n    title: 'Strikethrough'\n  },\n  'heading': {\n    name: 'heading',\n    action: toggleHeadingSmaller,\n    className: 'fa fa-header fa-heading',\n    title: 'Heading',\n    default: true\n  },\n  'heading-smaller': {\n    name: 'heading-smaller',\n    action: toggleHeadingSmaller,\n    className: 'fa fa-header fa-heading header-smaller',\n    title: 'Smaller Heading'\n  },\n  'heading-bigger': {\n    name: 'heading-bigger',\n    action: toggleHeadingBigger,\n    className: 'fa fa-header fa-heading header-bigger',\n    title: 'Bigger Heading'\n  },\n  'heading-1': {\n    name: 'heading-1',\n    action: toggleHeading1,\n    className: 'fa fa-header fa-heading header-1',\n    title: 'Big Heading'\n  },\n  'heading-2': {\n    name: 'heading-2',\n    action: toggleHeading2,\n    className: 'fa fa-header fa-heading header-2',\n    title: 'Medium Heading'\n  },\n  'heading-3': {\n    name: 'heading-3',\n    action: toggleHeading3,\n    className: 'fa fa-header fa-heading header-3',\n    title: 'Small Heading'\n  },\n  'separator-1': {\n    name: 'separator-1'\n  },\n  'code': {\n    name: 'code',\n    action: toggleCodeBlock,\n    className: 'fa fa-code',\n    title: 'Code'\n  },\n  'quote': {\n    name: 'quote',\n    action: toggleBlockquote,\n    className: 'fa fa-quote-left',\n    title: 'Quote',\n    default: true\n  },\n  'unordered-list': {\n    name: 'unordered-list',\n    action: toggleUnorderedList,\n    className: 'fa fa-list-ul',\n    title: 'Generic List',\n    default: true\n  },\n  'ordered-list': {\n    name: 'ordered-list',\n    action: toggleOrderedList,\n    className: 'fa fa-list-ol',\n    title: 'Numbered List',\n    default: true\n  },\n  'clean-block': {\n    name: 'clean-block',\n    action: cleanBlock,\n    className: 'fa fa-eraser',\n    title: 'Clean block'\n  },\n  'separator-2': {\n    name: 'separator-2'\n  },\n  'link': {\n    name: 'link',\n    action: drawLink,\n    className: 'fa fa-link',\n    title: 'Create Link',\n    default: true\n  },\n  'image': {\n    name: 'image',\n    action: drawImage,\n    className: 'fa fa-image',\n    title: 'Insert Image',\n    default: true\n  },\n  'upload-image': {\n    name: 'upload-image',\n    action: drawUploadedImage,\n    className: 'fa fa-image',\n    title: 'Import an image'\n  },\n  'table': {\n    name: 'table',\n    action: drawTable,\n    className: 'fa fa-table',\n    title: 'Insert Table'\n  },\n  'horizontal-rule': {\n    name: 'horizontal-rule',\n    action: drawHorizontalRule,\n    className: 'fa fa-minus',\n    title: 'Insert Horizontal Line'\n  },\n  'separator-3': {\n    name: 'separator-3'\n  },\n  'preview': {\n    name: 'preview',\n    action: togglePreview,\n    className: 'fa fa-eye',\n    noDisable: true,\n    title: 'Toggle Preview',\n    default: true\n  },\n  'side-by-side': {\n    name: 'side-by-side',\n    action: toggleSideBySide,\n    className: 'fa fa-columns',\n    noDisable: true,\n    noMobile: true,\n    title: 'Toggle Side by Side',\n    default: true\n  },\n  'fullscreen': {\n    name: 'fullscreen',\n    action: toggleFullScreen,\n    className: 'fa fa-arrows-alt',\n    noDisable: true,\n    noMobile: true,\n    title: 'Toggle Fullscreen',\n    default: true\n  },\n  'separator-4': {\n    name: 'separator-4'\n  },\n  'guide': {\n    name: 'guide',\n    action: 'https://www.markdownguide.org/basic-syntax/',\n    className: 'fa fa-question-circle',\n    noDisable: true,\n    title: 'Markdown Guide',\n    default: true\n  },\n  'separator-5': {\n    name: 'separator-5'\n  },\n  'undo': {\n    name: 'undo',\n    action: undo,\n    className: 'fa fa-undo',\n    noDisable: true,\n    title: 'Undo'\n  },\n  'redo': {\n    name: 'redo',\n    action: redo,\n    className: 'fa fa-repeat fa-redo',\n    noDisable: true,\n    title: 'Redo'\n  }\n};\nvar insertTexts = {\n  link: ['[', '](#url#)'],\n  image: ['![](', '#url#)'],\n  uploadedImage: ['![](#url#)', ''],\n  // uploadedImage: ['![](#url#)\\n', ''], // TODO: New line insertion doesn't work here.\n  table: ['', '\\n\\n| Column 1 | Column 2 | Column 3 |\\n| -------- | -------- | -------- |\\n| Text     | Text     | Text     |\\n\\n'],\n  horizontalRule: ['', '\\n\\n-----\\n\\n']\n};\nvar promptTexts = {\n  link: 'URL for the link:',\n  image: 'URL of the image:'\n};\nvar blockStyles = {\n  'bold': '**',\n  'code': '```',\n  'italic': '*'\n};\n/**\n * Texts displayed to the user (mainly on the status bar) for the import image\n * feature. Can be used for customization or internationalization.\n */\n\nvar imageTexts = {\n  sbInit: 'Attach files by drag and dropping or pasting from clipboard.',\n  sbOnDragEnter: 'Drop image to upload it.',\n  sbOnDrop: 'Uploading image #images_names#...',\n  sbProgress: 'Uploading #file_name#: #progress#%',\n  sbOnUploaded: 'Uploaded #image_name#',\n  sizeUnits: 'b,Kb,Mb'\n};\n/**\n * Errors displayed to the user, using the `errorCallback` option. Can be used for\n * customization or internationalization.\n */\n\nvar errorMessages = {\n  noFileGiven: 'You must select a file.',\n  typeNotAllowed: 'This image type is not allowed.',\n  fileTooLarge: 'Image #image_name# is too big (#image_size#).\\n' + 'Maximum file size is #image_max_size#.',\n  importError: 'Something went wrong when uploading the image #image_name#.'\n};\n/**\n * Interface of EasyMDE.\n */\n\nfunction EasyMDE(options) {\n  // Handle options parameter\n  options = options || {}; // Used later to refer to it\"s parent\n\n  options.parent = this; // Check if Font Awesome needs to be auto downloaded\n\n  var autoDownloadFA = true;\n\n  if (options.autoDownloadFontAwesome === false) {\n    autoDownloadFA = false;\n  }\n\n  if (options.autoDownloadFontAwesome !== true) {\n    var styleSheets = document.styleSheets;\n\n    for (var i = 0; i < styleSheets.length; i++) {\n      if (!styleSheets[i].href) continue;\n\n      if (styleSheets[i].href.indexOf('//maxcdn.bootstrapcdn.com/font-awesome/') > -1) {\n        autoDownloadFA = false;\n      }\n    }\n  }\n\n  if (autoDownloadFA) {\n    var link = document.createElement('link');\n    link.rel = 'stylesheet';\n    link.href = 'https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css';\n    document.getElementsByTagName('head')[0].appendChild(link);\n  } // Find the textarea to use\n\n\n  if (options.element) {\n    this.element = options.element;\n  } else if (options.element === null) {\n    // This means that the element option was specified, but no element was found\n    console.log('EasyMDE: Error. No element was found.');\n    return;\n  } // Handle toolbar\n\n\n  if (options.toolbar === undefined) {\n    // Initialize\n    options.toolbar = []; // Loop over the built in buttons, to get the preferred order\n\n    for (var key in toolbarBuiltInButtons) {\n      if (Object.prototype.hasOwnProperty.call(toolbarBuiltInButtons, key)) {\n        if (key.indexOf('separator-') != -1) {\n          options.toolbar.push('|');\n        }\n\n        if (toolbarBuiltInButtons[key].default === true || options.showIcons && options.showIcons.constructor === Array && options.showIcons.indexOf(key) != -1) {\n          options.toolbar.push(key);\n        }\n      }\n    }\n  } // Editor preview styling class.\n\n\n  if (!Object.prototype.hasOwnProperty.call(options, 'previewClass')) {\n    options.previewClass = 'editor-preview';\n  } // Handle status bar\n\n\n  if (!Object.prototype.hasOwnProperty.call(options, 'status')) {\n    options.status = ['autosave', 'lines', 'words', 'cursor'];\n\n    if (options.uploadImage) {\n      options.status.unshift('upload-image');\n    }\n  } // Add default preview rendering function\n\n\n  if (!options.previewRender) {\n    options.previewRender = function (plainText) {\n      // Note: \"this\" refers to the options object\n      return this.parent.markdown(plainText);\n    };\n  } // Set default options for parsing config\n\n\n  options.parsingConfig = extend({\n    highlightFormatting: true // needed for toggleCodeBlock to detect types of code\n\n  }, options.parsingConfig || {}); // Merging the insertTexts, with the given options\n\n  options.insertTexts = extend({}, insertTexts, options.insertTexts || {}); // Merging the promptTexts, with the given options\n\n  options.promptTexts = extend({}, promptTexts, options.promptTexts || {}); // Merging the blockStyles, with the given options\n\n  options.blockStyles = extend({}, blockStyles, options.blockStyles || {}); // Merging the shortcuts, with the given options\n\n  options.shortcuts = extend({}, shortcuts, options.shortcuts || {});\n  options.minHeight = options.minHeight || '300px';\n\n  options.errorCallback = options.errorCallback || function (errorMessage) {\n    alert(errorMessage);\n  }; // Import-image default configuration\n\n\n  options.uploadImage = options.uploadImage || false;\n  options.imageMaxSize = options.imageMaxSize || 2097152; // 1024 * 1024 * 2\n\n  options.imageAccept = options.imageAccept || 'image/png, image/jpeg';\n  options.imageTexts = extend({}, imageTexts, options.imageTexts || {});\n  options.errorMessages = extend({}, errorMessages, options.errorMessages || {}); // Change unique_id to uniqueId for backwards compatibility\n\n  if (options.autosave != undefined && options.autosave.unique_id != undefined && options.autosave.unique_id != '') options.autosave.uniqueId = options.autosave.unique_id; // Update this options\n\n  this.options = options; // Auto render\n\n  this.render(); // The codemirror component is only available after rendering\n  // so, the setter for the initialValue can only run after\n  // the element has been rendered\n\n  if (options.initialValue && (!this.options.autosave || this.options.autosave.foundSavedValue !== true)) {\n    this.value(options.initialValue);\n  }\n\n  if (options.uploadImage) {\n    var self = this;\n    this.codemirror.on('dragenter', function (cm, event) {\n      self.updateStatusBar('upload-image', self.options.imageTexts.sbOnDragEnter);\n      event.stopPropagation();\n      event.preventDefault();\n    });\n    this.codemirror.on('dragend', function (cm, event) {\n      self.updateStatusBar('upload-image', self.options.imageTexts.sbInit);\n      event.stopPropagation();\n      event.preventDefault();\n    });\n    this.codemirror.on('dragleave', function (cm, event) {\n      self.updateStatusBar('upload-image', self.options.imageTexts.sbInit);\n      event.stopPropagation();\n      event.preventDefault();\n    });\n    this.codemirror.on('dragover', function (cm, event) {\n      self.updateStatusBar('upload-image', self.options.imageTexts.sbOnDragEnter);\n      event.stopPropagation();\n      event.preventDefault();\n    });\n    this.codemirror.on('drop', function (cm, event) {\n      event.stopPropagation();\n      event.preventDefault();\n\n      if (options.imageUploadFunction) {\n        self.uploadImagesUsingCustomFunction(options.imageUploadFunction, event.dataTransfer.files);\n      } else {\n        self.uploadImages(event.dataTransfer.files);\n      }\n    });\n    this.codemirror.on('paste', function (cm, event) {\n      if (options.imageUploadFunction) {\n        self.uploadImagesUsingCustomFunction(options.imageUploadFunction, event.clipboardData.files);\n      } else {\n        self.uploadImages(event.clipboardData.files);\n      }\n    });\n  }\n}\n/**\n * Upload asynchronously a list of images to a server.\n *\n * Can be triggered by:\n * - drag&drop;\n * - copy-paste;\n * - the browse-file window (opened when the user clicks on the *upload-image* icon).\n * @param {FileList} files The files to upload the the server.\n * @param [onSuccess] {function} see EasyMDE.prototype.uploadImage\n * @param [onError] {function} see EasyMDE.prototype.uploadImage\n */\n\n\nEasyMDE.prototype.uploadImages = function (files, onSuccess, onError) {\n  if (files.length === 0) {\n    return;\n  }\n\n  var names = [];\n\n  for (var i = 0; i < files.length; i++) {\n    names.push(files[i].name);\n    this.uploadImage(files[i], onSuccess, onError);\n  }\n\n  this.updateStatusBar('upload-image', this.options.imageTexts.sbOnDrop.replace('#images_names#', names.join(', ')));\n};\n/**\n * Upload asynchronously a list of images to a server.\n *\n * Can be triggered by:\n * - drag&drop;\n * - copy-paste;\n * - the browse-file window (opened when the user clicks on the *upload-image* icon).\n * @param imageUploadFunction {Function} The custom function to upload the image passed in options.\n * @param {FileList} files The files to upload the the server.\n */\n\n\nEasyMDE.prototype.uploadImagesUsingCustomFunction = function (imageUploadFunction, files) {\n  if (files.length === 0) {\n    return;\n  }\n\n  var names = [];\n\n  for (var i = 0; i < files.length; i++) {\n    names.push(files[i].name);\n    this.uploadImageUsingCustomFunction(imageUploadFunction, files[i]);\n  }\n\n  this.updateStatusBar('upload-image', this.options.imageTexts.sbOnDrop.replace('#images_names#', names.join(', ')));\n};\n/**\n * Update an item in the status bar.\n * @param itemName {string} The name of the item to update (ie. 'upload-image', 'autosave', etc.).\n * @param content {string} the new content of the item to write in the status bar.\n */\n\n\nEasyMDE.prototype.updateStatusBar = function (itemName, content) {\n  var matchingClasses = this.gui.statusbar.getElementsByClassName(itemName);\n\n  if (matchingClasses.length === 1) {\n    this.gui.statusbar.getElementsByClassName(itemName)[0].textContent = content;\n  } else if (matchingClasses.length === 0) {\n    console.log('EasyMDE: status bar item ' + itemName + ' was not found.');\n  } else {\n    console.log('EasyMDE: Several status bar items named ' + itemName + ' was found.');\n  }\n};\n/**\n * Default markdown render.\n */\n\n\nEasyMDE.prototype.markdown = function (text) {\n  if (marked) {\n    // Initialize\n    var markedOptions;\n\n    if (this.options && this.options.renderingConfig && this.options.renderingConfig.markedOptions) {\n      markedOptions = this.options.renderingConfig.markedOptions;\n    } else {\n      markedOptions = {};\n    } // Update options\n\n\n    if (this.options && this.options.renderingConfig && this.options.renderingConfig.singleLineBreaks === false) {\n      markedOptions.breaks = false;\n    } else {\n      markedOptions.breaks = true;\n    }\n\n    if (this.options && this.options.renderingConfig && this.options.renderingConfig.codeSyntaxHighlighting === true) {\n      /* Get HLJS from config or window */\n      var hljs = this.options.renderingConfig.hljs || window.hljs;\n      /* Check if HLJS loaded */\n\n      if (hljs) {\n        markedOptions.highlight = function (code) {\n          return hljs.highlightAuto(code).value;\n        };\n      }\n    } // Set options\n\n\n    marked.setOptions(markedOptions); // Convert the markdown to HTML\n\n    var htmlText = marked(text); // Edit the HTML anchors to add 'target=\"_blank\"' by default.\n\n    htmlText = addAnchorTargetBlank(htmlText);\n    return htmlText;\n  }\n};\n/**\n * Render editor to the given element.\n */\n\n\nEasyMDE.prototype.render = function (el) {\n  if (!el) {\n    el = this.element || document.getElementsByTagName('textarea')[0];\n  }\n\n  if (this._rendered && this._rendered === el) {\n    // Already rendered.\n    return;\n  }\n\n  this.element = el;\n  var options = this.options;\n  var self = this;\n  var keyMaps = {};\n\n  for (var key in options.shortcuts) {\n    // null stands for \"do not bind this command\"\n    if (options.shortcuts[key] !== null && bindings[key] !== null) {\n      (function (key) {\n        keyMaps[fixShortcut(options.shortcuts[key])] = function () {\n          var action = bindings[key];\n\n          if (typeof action === 'function') {\n            action(self);\n          } else if (typeof action === 'string') {\n            window.open(action, '_blank');\n          }\n        };\n      })(key);\n    }\n  }\n\n  keyMaps['Enter'] = 'newlineAndIndentContinueMarkdownList';\n  keyMaps['Tab'] = 'tabAndIndentMarkdownList';\n  keyMaps['Shift-Tab'] = 'shiftTabAndUnindentMarkdownList';\n\n  keyMaps['Esc'] = function (cm) {\n    if (cm.getOption('fullScreen')) toggleFullScreen(self);\n  };\n\n  document.addEventListener('keydown', function (e) {\n    e = e || window.event;\n\n    if (e.keyCode == 27) {\n      if (self.codemirror.getOption('fullScreen')) toggleFullScreen(self);\n    }\n  }, false);\n  var mode, backdrop;\n\n  if (options.spellChecker !== false) {\n    mode = 'spell-checker';\n    backdrop = options.parsingConfig;\n    backdrop.name = 'gfm';\n    backdrop.gitHubSpice = false;\n    CodeMirrorSpellChecker({\n      codeMirrorInstance: CodeMirror\n    });\n  } else {\n    mode = options.parsingConfig;\n    mode.name = 'gfm';\n    mode.gitHubSpice = false;\n  } // eslint-disable-next-line no-unused-vars\n\n\n  function configureMouse(cm, repeat, event) {\n    return {\n      addNew: false\n    };\n  }\n\n  this.codemirror = CodeMirror.fromTextArea(el, {\n    mode: mode,\n    backdrop: backdrop,\n    theme: options.theme != undefined ? options.theme : 'easymde',\n    tabSize: options.tabSize != undefined ? options.tabSize : 2,\n    indentUnit: options.tabSize != undefined ? options.tabSize : 2,\n    indentWithTabs: options.indentWithTabs === false ? false : true,\n    lineNumbers: false,\n    autofocus: options.autofocus === true ? true : false,\n    extraKeys: keyMaps,\n    lineWrapping: options.lineWrapping === false ? false : true,\n    allowDropFileTypes: ['text/plain'],\n    placeholder: options.placeholder || el.getAttribute('placeholder') || '',\n    styleSelectedText: options.styleSelectedText != undefined ? options.styleSelectedText : !isMobile(),\n    configureMouse: configureMouse\n  });\n  this.codemirror.getScrollerElement().style.minHeight = options.minHeight;\n\n  if (options.forceSync === true) {\n    var cm = this.codemirror;\n    cm.on('change', function () {\n      cm.save();\n    });\n  }\n\n  this.gui = {};\n\n  if (options.toolbar !== false) {\n    this.gui.toolbar = this.createToolbar();\n  }\n\n  if (options.status !== false) {\n    this.gui.statusbar = this.createStatusbar();\n  }\n\n  if (options.autosave != undefined && options.autosave.enabled === true) {\n    this.autosave();\n  }\n\n  this.gui.sideBySide = this.createSideBySide();\n  this._rendered = this.element; // Fixes CodeMirror bug (#344)\n\n  var temp_cm = this.codemirror;\n  setTimeout(function () {\n    temp_cm.refresh();\n  }.bind(temp_cm), 0);\n}; // Safari, in Private Browsing Mode, looks like it supports localStorage but all calls to setItem throw QuotaExceededError. We're going to detect this and set a variable accordingly.\n\n\nfunction isLocalStorageAvailable() {\n  if (typeof localStorage === 'object') {\n    try {\n      localStorage.setItem('smde_localStorage', 1);\n      localStorage.removeItem('smde_localStorage');\n    } catch (e) {\n      return false;\n    }\n  } else {\n    return false;\n  }\n\n  return true;\n}\n\nEasyMDE.prototype.autosave = function () {\n  if (isLocalStorageAvailable()) {\n    var easyMDE = this;\n\n    if (this.options.autosave.uniqueId == undefined || this.options.autosave.uniqueId == '') {\n      console.log('EasyMDE: You must set a uniqueId to use the autosave feature');\n      return;\n    }\n\n    if (this.options.autosave.binded !== true) {\n      if (easyMDE.element.form != null && easyMDE.element.form != undefined) {\n        easyMDE.element.form.addEventListener('submit', function () {\n          clearTimeout(easyMDE.autosaveTimeoutId);\n          easyMDE.autosaveTimeoutId = undefined;\n          localStorage.removeItem('smde_' + easyMDE.options.autosave.uniqueId); // Restart autosaving in case the submit will be cancelled down the line\n\n          setTimeout(function () {\n            easyMDE.autosave();\n          }, easyMDE.options.autosave.delay || 10000);\n        });\n      }\n\n      this.options.autosave.binded = true;\n    }\n\n    if (this.options.autosave.loaded !== true) {\n      if (typeof localStorage.getItem('smde_' + this.options.autosave.uniqueId) == 'string' && localStorage.getItem('smde_' + this.options.autosave.uniqueId) != '') {\n        this.codemirror.setValue(localStorage.getItem('smde_' + this.options.autosave.uniqueId));\n        this.options.autosave.foundSavedValue = true;\n      }\n\n      this.options.autosave.loaded = true;\n    }\n\n    localStorage.setItem('smde_' + this.options.autosave.uniqueId, easyMDE.value());\n    var el = document.getElementById('autosaved');\n\n    if (el != null && el != undefined && el != '') {\n      var d = new Date();\n      var hh = d.getHours();\n      var m = d.getMinutes();\n      var dd = 'am';\n      var h = hh;\n\n      if (h >= 12) {\n        h = hh - 12;\n        dd = 'pm';\n      }\n\n      if (h == 0) {\n        h = 12;\n      }\n\n      m = m < 10 ? '0' + m : m;\n      el.innerHTML = 'Autosaved: ' + h + ':' + m + ' ' + dd;\n    }\n\n    this.autosaveTimeoutId = setTimeout(function () {\n      easyMDE.autosave();\n    }, this.options.autosave.delay || 10000);\n  } else {\n    console.log('EasyMDE: localStorage not available, cannot autosave');\n  }\n};\n\nEasyMDE.prototype.clearAutosavedValue = function () {\n  if (isLocalStorageAvailable()) {\n    if (this.options.autosave == undefined || this.options.autosave.uniqueId == undefined || this.options.autosave.uniqueId == '') {\n      console.log('EasyMDE: You must set a uniqueId to clear the autosave value');\n      return;\n    }\n\n    localStorage.removeItem('smde_' + this.options.autosave.uniqueId);\n  } else {\n    console.log('EasyMDE: localStorage not available, cannot autosave');\n  }\n};\n/**\n * Open the browse-file window to upload an image to a server.\n * @param [onSuccess] {function} see EasyMDE.prototype.uploadImage\n * @param [onError] {function} see EasyMDE.prototype.uploadImage\n */\n\n\nEasyMDE.prototype.openBrowseFileWindow = function (onSuccess, onError) {\n  var self = this;\n  var imageInput = this.gui.toolbar.getElementsByClassName('imageInput')[0];\n  imageInput.click(); //dispatchEvent(new MouseEvent('click'));  // replaced with click() for IE11 compatibility.\n\n  function onChange(event) {\n    if (self.options.imageUploadFunction) {\n      self.uploadImagesUsingCustomFunction(self.options.imageUploadFunction, event.target.files);\n    } else {\n      self.uploadImages(event.target.files, onSuccess, onError);\n    }\n\n    imageInput.removeEventListener('change', onChange);\n  }\n\n  imageInput.addEventListener('change', onChange);\n};\n/**\n * Upload an image to the server.\n *\n * @param file {File} The image to upload, as a HTML5 File object (https://developer.mozilla.org/en-US/docs/Web/API/File)\n * @param [onSuccess] {function} A callback function to execute after the image has been successfully uploaded, with one parameter:\n * - url (string): The URL of the uploaded image.\n * @param [onError] {function} A callback function to execute when the image upload fails, with one parameter:\n * - error (string): the detailed error to display to the user (based on messages from options.errorMessages).\n */\n\n\nEasyMDE.prototype.uploadImage = function (file, onSuccess, onError) {\n  var self = this;\n\n  onSuccess = onSuccess || function onSuccess(imageUrl) {\n    afterImageUploaded(self, imageUrl);\n  };\n\n  function onErrorSup(errorMessage) {\n    // show error on status bar and reset after 10000ms\n    self.updateStatusBar('upload-image', errorMessage);\n    setTimeout(function () {\n      self.updateStatusBar('upload-image', self.options.imageTexts.sbInit);\n    }, 10000); // run custom error handler\n\n    if (onError && typeof onError === 'function') {\n      onError(errorMessage);\n    } // run error handler from options, this alerts the message.\n\n\n    self.options.errorCallback(errorMessage);\n  }\n\n  function fillErrorMessage(errorMessage) {\n    var units = self.options.imageTexts.sizeUnits.split(',');\n    return errorMessage.replace('#image_name#', file.name).replace('#image_size#', humanFileSize(file.size, units)).replace('#image_max_size#', humanFileSize(self.options.imageMaxSize, units));\n  }\n\n  if (file.size > this.options.imageMaxSize) {\n    onErrorSup(fillErrorMessage(this.options.errorMessages.fileTooLarge));\n    return;\n  }\n\n  var formData = new FormData();\n  formData.append('image', file); // insert CSRF token if provided in config.\n\n  if (self.options.imageCSRFToken) {\n    formData.append('csrfmiddlewaretoken', self.options.imageCSRFToken);\n  }\n\n  var request = new XMLHttpRequest();\n\n  request.upload.onprogress = function (event) {\n    if (event.lengthComputable) {\n      var progress = '' + Math.round(event.loaded * 100 / event.total);\n      self.updateStatusBar('upload-image', self.options.imageTexts.sbProgress.replace('#file_name#', file.name).replace('#progress#', progress));\n    }\n  };\n\n  request.open('POST', this.options.imageUploadEndpoint);\n\n  request.onload = function () {\n    try {\n      var response = JSON.parse(this.responseText);\n    } catch (error) {\n      console.error('EasyMDE: The server did not return a valid json.');\n      onErrorSup(fillErrorMessage(self.options.errorMessages.importError));\n      return;\n    }\n\n    if (this.status === 200 && response && !response.error && response.data && response.data.filePath) {\n      onSuccess(window.location.origin + '/' + response.data.filePath);\n    } else {\n      if (response.error && response.error in self.options.errorMessages) {\n        // preformatted error message\n        onErrorSup(fillErrorMessage(self.options.errorMessages[response.error]));\n      } else if (response.error) {\n        // server side generated error message\n        onErrorSup(fillErrorMessage(response.error));\n      } else {\n        //unknown error\n        console.error('EasyMDE: Received an unexpected response after uploading the image.' + this.status + ' (' + this.statusText + ')');\n        onErrorSup(fillErrorMessage(self.options.errorMessages.importError));\n      }\n    }\n  };\n\n  request.onerror = function (event) {\n    console.error('EasyMDE: An unexpected error occurred when trying to upload the image.' + event.target.status + ' (' + event.target.statusText + ')');\n    onErrorSup(self.options.errorMessages.importError);\n  };\n\n  request.send(formData);\n};\n/**\n * Upload an image to the server using a custom upload function.\n *\n * @param imageUploadFunction {Function} The custom function to upload the image passed in options\n * @param file {File} The image to upload, as a HTML5 File object (https://developer.mozilla.org/en-US/docs/Web/API/File).\n */\n\n\nEasyMDE.prototype.uploadImageUsingCustomFunction = function (imageUploadFunction, file) {\n  var self = this;\n\n  function onSuccess(imageUrl) {\n    afterImageUploaded(self, imageUrl);\n  }\n\n  function onError(errorMessage) {\n    var filledErrorMessage = fillErrorMessage(errorMessage); // show error on status bar and reset after 10000ms\n\n    self.updateStatusBar('upload-image', filledErrorMessage);\n    setTimeout(function () {\n      self.updateStatusBar('upload-image', self.options.imageTexts.sbInit);\n    }, 10000); // run error handler from options, this alerts the message.\n\n    self.options.errorCallback(filledErrorMessage);\n  }\n\n  function fillErrorMessage(errorMessage) {\n    var units = self.options.imageTexts.sizeUnits.split(',');\n    return errorMessage.replace('#image_name#', file.name).replace('#image_size#', humanFileSize(file.size, units)).replace('#image_max_size#', humanFileSize(self.options.imageMaxSize, units));\n  }\n\n  imageUploadFunction(file, onSuccess, onError);\n};\n\nEasyMDE.prototype.createSideBySide = function () {\n  var cm = this.codemirror;\n  var wrapper = cm.getWrapperElement();\n  var preview = wrapper.nextSibling;\n\n  if (!preview || !/editor-preview-side/.test(preview.className)) {\n    preview = document.createElement('div');\n    preview.className = 'editor-preview-side';\n\n    if (this.options.previewClass) {\n      if (Array.isArray(this.options.previewClass)) {\n        for (var i = 0; i < this.options.previewClass.length; i++) {\n          preview.className += ' ' + this.options.previewClass[i];\n        }\n      } else if (typeof this.options.previewClass === 'string') {\n        preview.className += ' ' + this.options.previewClass;\n      }\n    }\n\n    wrapper.parentNode.insertBefore(preview, wrapper.nextSibling);\n  }\n\n  if (this.options.syncSideBySidePreviewScroll === false) return preview; // Syncs scroll  editor -> preview\n\n  var cScroll = false;\n  var pScroll = false;\n  cm.on('scroll', function (v) {\n    if (cScroll) {\n      cScroll = false;\n      return;\n    }\n\n    pScroll = true;\n    var height = v.getScrollInfo().height - v.getScrollInfo().clientHeight;\n    var ratio = parseFloat(v.getScrollInfo().top) / height;\n    var move = (preview.scrollHeight - preview.clientHeight) * ratio;\n    preview.scrollTop = move;\n  }); // Syncs scroll  preview -> editor\n\n  preview.onscroll = function () {\n    if (pScroll) {\n      pScroll = false;\n      return;\n    }\n\n    cScroll = true;\n    var height = preview.scrollHeight - preview.clientHeight;\n    var ratio = parseFloat(preview.scrollTop) / height;\n    var move = (cm.getScrollInfo().height - cm.getScrollInfo().clientHeight) * ratio;\n    cm.scrollTo(0, move);\n  };\n\n  return preview;\n};\n\nEasyMDE.prototype.createToolbar = function (items) {\n  items = items || this.options.toolbar;\n\n  if (!items || items.length === 0) {\n    return;\n  }\n\n  var i;\n\n  for (i = 0; i < items.length; i++) {\n    if (toolbarBuiltInButtons[items[i]] != undefined) {\n      items[i] = toolbarBuiltInButtons[items[i]];\n    }\n  }\n\n  var bar = document.createElement('div');\n  bar.className = 'editor-toolbar';\n  var self = this;\n  var toolbarData = {};\n  self.toolbar = items;\n\n  for (i = 0; i < items.length; i++) {\n    if (items[i].name == 'guide' && self.options.toolbarGuideIcon === false) continue;\n    if (self.options.hideIcons && self.options.hideIcons.indexOf(items[i].name) != -1) continue; // Fullscreen does not work well on mobile devices (even tablets)\n    // In the future, hopefully this can be resolved\n\n    if ((items[i].name == 'fullscreen' || items[i].name == 'side-by-side') && isMobile()) continue; // Don't include trailing separators\n\n    if (items[i] === '|') {\n      var nonSeparatorIconsFollow = false;\n\n      for (var x = i + 1; x < items.length; x++) {\n        if (items[x] !== '|' && (!self.options.hideIcons || self.options.hideIcons.indexOf(items[x].name) == -1)) {\n          nonSeparatorIconsFollow = true;\n        }\n      }\n\n      if (!nonSeparatorIconsFollow) continue;\n    } // Create the icon and append to the toolbar\n\n\n    (function (item) {\n      var el;\n\n      if (item === '|') {\n        el = createSep();\n      } else {\n        el = createToolbarButton(item, self.options.toolbarTips, self.options.shortcuts);\n      } // bind events, special for info\n\n\n      if (item.action) {\n        if (typeof item.action === 'function') {\n          el.onclick = function (e) {\n            e.preventDefault();\n            item.action(self);\n          };\n        } else if (typeof item.action === 'string') {\n          el.onclick = function (e) {\n            e.preventDefault();\n            window.open(item.action, '_blank');\n          };\n        }\n      }\n\n      toolbarData[item.name || item] = el;\n      bar.appendChild(el); // Create the input element (ie. <input type='file'>), used among\n      // with the 'import-image' icon to open the browse-file window.\n\n      if (item.name === 'upload-image') {\n        var imageInput = document.createElement('input');\n        imageInput.className = 'imageInput';\n        imageInput.type = 'file';\n        imageInput.multiple = true;\n        imageInput.name = 'image';\n        imageInput.accept = self.options.imageAccept;\n        imageInput.style.display = 'none';\n        imageInput.style.opacity = 0;\n        bar.appendChild(imageInput);\n      }\n    })(items[i]);\n  }\n\n  self.toolbarElements = toolbarData;\n  var cm = this.codemirror;\n  cm.on('cursorActivity', function () {\n    var stat = getState(cm);\n\n    for (var key in toolbarData) {\n      (function (key) {\n        var el = toolbarData[key];\n\n        if (stat[key]) {\n          el.className += ' active';\n        } else if (key != 'fullscreen' && key != 'side-by-side') {\n          el.className = el.className.replace(/\\s*active\\s*/g, '');\n        }\n      })(key);\n    }\n  });\n  var cmWrapper = cm.getWrapperElement();\n  cmWrapper.parentNode.insertBefore(bar, cmWrapper);\n  return bar;\n};\n\nEasyMDE.prototype.createStatusbar = function (status) {\n  // Initialize\n  status = status || this.options.status;\n  var options = this.options;\n  var cm = this.codemirror; // Make sure the status variable is valid\n\n  if (!status || status.length === 0) {\n    return;\n  } // Set up the built-in items\n\n\n  var items = [];\n  var i, onUpdate, defaultValue;\n\n  for (i = 0; i < status.length; i++) {\n    // Reset some values\n    onUpdate = undefined;\n    defaultValue = undefined; // Handle if custom or not\n\n    if (typeof status[i] === 'object') {\n      items.push({\n        className: status[i].className,\n        defaultValue: status[i].defaultValue,\n        onUpdate: status[i].onUpdate\n      });\n    } else {\n      var name = status[i];\n\n      if (name === 'words') {\n        defaultValue = function defaultValue(el) {\n          el.innerHTML = wordCount(cm.getValue());\n        };\n\n        onUpdate = function onUpdate(el) {\n          el.innerHTML = wordCount(cm.getValue());\n        };\n      } else if (name === 'lines') {\n        defaultValue = function defaultValue(el) {\n          el.innerHTML = cm.lineCount();\n        };\n\n        onUpdate = function onUpdate(el) {\n          el.innerHTML = cm.lineCount();\n        };\n      } else if (name === 'cursor') {\n        defaultValue = function defaultValue(el) {\n          el.innerHTML = '0:0';\n        };\n\n        onUpdate = function onUpdate(el) {\n          var pos = cm.getCursor();\n          el.innerHTML = pos.line + ':' + pos.ch;\n        };\n      } else if (name === 'autosave') {\n        defaultValue = function defaultValue(el) {\n          if (options.autosave != undefined && options.autosave.enabled === true) {\n            el.setAttribute('id', 'autosaved');\n          }\n        };\n      } else if (name === 'upload-image') {\n        defaultValue = function defaultValue(el) {\n          el.innerHTML = options.imageTexts.sbInit;\n        };\n      }\n\n      items.push({\n        className: name,\n        defaultValue: defaultValue,\n        onUpdate: onUpdate\n      });\n    }\n  } // Create element for the status bar\n\n\n  var bar = document.createElement('div');\n  bar.className = 'editor-statusbar'; // Create a new span for each item\n\n  for (i = 0; i < items.length; i++) {\n    // Store in temporary variable\n    var item = items[i]; // Create span element\n\n    var el = document.createElement('span');\n    el.className = item.className; // Ensure the defaultValue is a function\n\n    if (typeof item.defaultValue === 'function') {\n      item.defaultValue(el);\n    } // Ensure the onUpdate is a function\n\n\n    if (typeof item.onUpdate === 'function') {\n      // Create a closure around the span of the current action, then execute the onUpdate handler\n      this.codemirror.on('update', function (el, item) {\n        return function () {\n          item.onUpdate(el);\n        };\n      }(el, item));\n    } // Append the item to the status bar\n\n\n    bar.appendChild(el);\n  } // Insert the status bar into the DOM\n\n\n  var cmWrapper = this.codemirror.getWrapperElement();\n  cmWrapper.parentNode.insertBefore(bar, cmWrapper.nextSibling);\n  return bar;\n};\n/**\n * Get or set the text content.\n */\n\n\nEasyMDE.prototype.value = function (val) {\n  var cm = this.codemirror;\n\n  if (val === undefined) {\n    return cm.getValue();\n  } else {\n    cm.getDoc().setValue(val);\n\n    if (this.isPreviewActive()) {\n      var wrapper = cm.getWrapperElement();\n      var preview = wrapper.lastChild;\n      preview.innerHTML = this.options.previewRender(val, preview);\n    }\n\n    return this;\n  }\n};\n/**\n * Bind static methods for exports.\n */\n\n\nEasyMDE.toggleBold = toggleBold;\nEasyMDE.toggleItalic = toggleItalic;\nEasyMDE.toggleStrikethrough = toggleStrikethrough;\nEasyMDE.toggleBlockquote = toggleBlockquote;\nEasyMDE.toggleHeadingSmaller = toggleHeadingSmaller;\nEasyMDE.toggleHeadingBigger = toggleHeadingBigger;\nEasyMDE.toggleHeading1 = toggleHeading1;\nEasyMDE.toggleHeading2 = toggleHeading2;\nEasyMDE.toggleHeading3 = toggleHeading3;\nEasyMDE.toggleCodeBlock = toggleCodeBlock;\nEasyMDE.toggleUnorderedList = toggleUnorderedList;\nEasyMDE.toggleOrderedList = toggleOrderedList;\nEasyMDE.cleanBlock = cleanBlock;\nEasyMDE.drawLink = drawLink;\nEasyMDE.drawImage = drawImage;\nEasyMDE.drawTable = drawTable;\nEasyMDE.drawHorizontalRule = drawHorizontalRule;\nEasyMDE.undo = undo;\nEasyMDE.redo = redo;\nEasyMDE.togglePreview = togglePreview;\nEasyMDE.toggleSideBySide = toggleSideBySide;\nEasyMDE.toggleFullScreen = toggleFullScreen;\n/**\n * Bind instance methods for exports.\n */\n\nEasyMDE.prototype.toggleBold = function () {\n  toggleBold(this);\n};\n\nEasyMDE.prototype.toggleItalic = function () {\n  toggleItalic(this);\n};\n\nEasyMDE.prototype.toggleStrikethrough = function () {\n  toggleStrikethrough(this);\n};\n\nEasyMDE.prototype.toggleBlockquote = function () {\n  toggleBlockquote(this);\n};\n\nEasyMDE.prototype.toggleHeadingSmaller = function () {\n  toggleHeadingSmaller(this);\n};\n\nEasyMDE.prototype.toggleHeadingBigger = function () {\n  toggleHeadingBigger(this);\n};\n\nEasyMDE.prototype.toggleHeading1 = function () {\n  toggleHeading1(this);\n};\n\nEasyMDE.prototype.toggleHeading2 = function () {\n  toggleHeading2(this);\n};\n\nEasyMDE.prototype.toggleHeading3 = function () {\n  toggleHeading3(this);\n};\n\nEasyMDE.prototype.toggleCodeBlock = function () {\n  toggleCodeBlock(this);\n};\n\nEasyMDE.prototype.toggleUnorderedList = function () {\n  toggleUnorderedList(this);\n};\n\nEasyMDE.prototype.toggleOrderedList = function () {\n  toggleOrderedList(this);\n};\n\nEasyMDE.prototype.cleanBlock = function () {\n  cleanBlock(this);\n};\n\nEasyMDE.prototype.drawLink = function () {\n  drawLink(this);\n};\n\nEasyMDE.prototype.drawImage = function () {\n  drawImage(this);\n};\n\nEasyMDE.prototype.drawTable = function () {\n  drawTable(this);\n};\n\nEasyMDE.prototype.drawHorizontalRule = function () {\n  drawHorizontalRule(this);\n};\n\nEasyMDE.prototype.undo = function () {\n  undo(this);\n};\n\nEasyMDE.prototype.redo = function () {\n  redo(this);\n};\n\nEasyMDE.prototype.togglePreview = function () {\n  togglePreview(this);\n};\n\nEasyMDE.prototype.toggleSideBySide = function () {\n  toggleSideBySide(this);\n};\n\nEasyMDE.prototype.toggleFullScreen = function () {\n  toggleFullScreen(this);\n};\n\nEasyMDE.prototype.isPreviewActive = function () {\n  var cm = this.codemirror;\n  var wrapper = cm.getWrapperElement();\n  var preview = wrapper.lastChild;\n  return /editor-preview-active/.test(preview.className);\n};\n\nEasyMDE.prototype.isSideBySideActive = function () {\n  var cm = this.codemirror;\n  var wrapper = cm.getWrapperElement();\n  var preview = wrapper.nextSibling;\n  return /editor-preview-active-side/.test(preview.className);\n};\n\nEasyMDE.prototype.isFullscreenActive = function () {\n  var cm = this.codemirror;\n  return cm.getOption('fullScreen');\n};\n\nEasyMDE.prototype.getState = function () {\n  var cm = this.codemirror;\n  return getState(cm);\n};\n\nEasyMDE.prototype.toTextArea = function () {\n  var cm = this.codemirror;\n  var wrapper = cm.getWrapperElement();\n\n  if (wrapper.parentNode) {\n    if (this.gui.toolbar) {\n      wrapper.parentNode.removeChild(this.gui.toolbar);\n    }\n\n    if (this.gui.statusbar) {\n      wrapper.parentNode.removeChild(this.gui.statusbar);\n    }\n\n    if (this.gui.sideBySide) {\n      wrapper.parentNode.removeChild(this.gui.sideBySide);\n    }\n  }\n\n  cm.toTextArea();\n\n  if (this.autosaveTimeoutId) {\n    clearTimeout(this.autosaveTimeoutId);\n    this.autosaveTimeoutId = undefined;\n    this.clearAutosavedValue();\n  }\n};\n\nmodule.exports = EasyMDE;","map":{"version":3,"sources":["/Users/shayaansaiyed/Documents/Projects/notes-manager/node_modules/easymde/src/js/easymde.js"],"names":["CodeMirror","require","CodeMirrorSpellChecker","marked","isMac","test","navigator","platform","anchorToExternalRegex","RegExp","bindings","toggleBold","toggleItalic","drawLink","toggleHeadingSmaller","toggleHeadingBigger","drawImage","toggleBlockquote","toggleOrderedList","toggleUnorderedList","toggleCodeBlock","togglePreview","toggleStrikethrough","toggleHeading1","toggleHeading2","toggleHeading3","cleanBlock","drawTable","drawHorizontalRule","undo","redo","toggleSideBySide","toggleFullScreen","shortcuts","getBindingName","f","key","isMobile","check","a","substr","userAgent","vendor","window","opera","addAnchorTargetBlank","htmlText","match","exec","linkString","indexOf","fixedLinkString","replace","fixShortcut","name","createToolbarButton","options","enableTooltips","el","document","createElement","className","setAttribute","undefined","action","title","createTooltip","noDisable","classList","add","noMobile","classNameParts","split","iconClasses","classNameIndex","length","classNamePart","push","tabIndex","icon","iconClassIndex","iconClass","appendChild","createSep","innerHTML","actionName","tooltip","getState","cm","pos","getCursor","stat","getTokenAt","type","types","ret","data","text","i","bold","getLine","line","quote","italic","strikethrough","code","link","image","saved_overflow","editor","codemirror","setOption","getOption","body","style","overflow","wrap","getWrapperElement","previousSibling","toolbarElements","fullscreen","toolbarButton","sidebyside","nextSibling","onToggleFullScreen","_toggleBlock","blockStyles","fenceCharsToInsert","fencing_line","styles","token_state","token","state","base","code_type","line_num","firstTok","lastTok","getLineHandle","ch","indentedCode","fencedChars","insertFencingAtSelection","cur_start","cur_end","start_line_sel","end_line_sel","sel_multi","repl_start","repl_end","_replaceSelection","setSelection","tok","is_code","block_start","block_end","lineCount","start","slice","end","replaceRange","focus","fencedTok","fence_chars","start_text","start_line","end_text","end_line","operation","search_from","next_line","next_line_last_tok","next_line_indented","indentLine","no_sel_and_starting_of_line","_toggleLine","_toggleHeading","_cleanBlock","url","promptURLs","prompt","promptTexts","insertTexts","drawUploadedImage","openBrowseFileWindow","afterImageUploaded","imageName","lastIndexOf","uploadedImage","updateStatusBar","imageTexts","sbOnUploaded","setTimeout","sbInit","table","horizontalRule","wrapper","preview","useSideBySideListener","previewNormal","lastChild","toolbar","toolbar_div","sideBySideRenderingFunction","newValue","previewRender","value","on","off","refresh","previewClass","Array","isArray","active","startEnd","startPoint","endPoint","Object","assign","getSelection","replaceSelection","direction","size","currHeadingLevel","search","listRegexp","whitespacesRegexp","repl","_getChar","map","_checkChar","char","rt","_toggle","untoggleOnly","arr","start_chars","end_chars","join","humanFileSize","bytes","units","Math","abs","u","toFixed","_mergeProperties","target","source","property","prototype","hasOwnProperty","call","concat","constructor","extend","arguments","wordCount","pattern","m","count","charCodeAt","toolbarBuiltInButtons","default","sbOnDragEnter","sbOnDrop","sbProgress","sizeUnits","errorMessages","noFileGiven","typeNotAllowed","fileTooLarge","importError","EasyMDE","parent","autoDownloadFA","autoDownloadFontAwesome","styleSheets","href","rel","getElementsByTagName","element","console","log","showIcons","status","uploadImage","unshift","plainText","markdown","parsingConfig","highlightFormatting","minHeight","errorCallback","errorMessage","alert","imageMaxSize","imageAccept","autosave","unique_id","uniqueId","render","initialValue","foundSavedValue","self","event","stopPropagation","preventDefault","imageUploadFunction","uploadImagesUsingCustomFunction","dataTransfer","files","uploadImages","clipboardData","onSuccess","onError","names","uploadImageUsingCustomFunction","itemName","content","matchingClasses","gui","statusbar","getElementsByClassName","textContent","markedOptions","renderingConfig","singleLineBreaks","breaks","codeSyntaxHighlighting","hljs","highlight","highlightAuto","setOptions","_rendered","keyMaps","open","addEventListener","e","keyCode","mode","backdrop","spellChecker","gitHubSpice","codeMirrorInstance","configureMouse","repeat","addNew","fromTextArea","theme","tabSize","indentUnit","indentWithTabs","lineNumbers","autofocus","extraKeys","lineWrapping","allowDropFileTypes","placeholder","getAttribute","styleSelectedText","getScrollerElement","forceSync","save","createToolbar","createStatusbar","enabled","sideBySide","createSideBySide","temp_cm","bind","isLocalStorageAvailable","localStorage","setItem","removeItem","easyMDE","binded","form","clearTimeout","autosaveTimeoutId","delay","loaded","getItem","setValue","getElementById","d","Date","hh","getHours","getMinutes","dd","h","clearAutosavedValue","imageInput","click","onChange","removeEventListener","file","imageUrl","onErrorSup","fillErrorMessage","formData","FormData","append","imageCSRFToken","request","XMLHttpRequest","upload","onprogress","lengthComputable","progress","round","total","imageUploadEndpoint","onload","response","JSON","parse","responseText","error","filePath","location","origin","statusText","onerror","send","filledErrorMessage","parentNode","insertBefore","syncSideBySidePreviewScroll","cScroll","pScroll","v","height","getScrollInfo","clientHeight","ratio","parseFloat","top","move","scrollHeight","scrollTop","onscroll","scrollTo","items","bar","toolbarData","toolbarGuideIcon","hideIcons","nonSeparatorIconsFollow","x","item","toolbarTips","onclick","multiple","accept","display","opacity","cmWrapper","onUpdate","defaultValue","getValue","val","getDoc","isPreviewActive","isSideBySideActive","isFullscreenActive","toTextArea","removeChild","module","exports"],"mappings":"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","sourcesContent":["'use strict';\nvar CodeMirror = require('codemirror');\nrequire('codemirror/addon/edit/continuelist.js');\nrequire('./codemirror/tablist');\nrequire('codemirror/addon/display/fullscreen.js');\nrequire('codemirror/mode/markdown/markdown.js');\nrequire('codemirror/addon/mode/overlay.js');\nrequire('codemirror/addon/display/placeholder.js');\nrequire('codemirror/addon/selection/mark-selection.js');\nrequire('codemirror/addon/search/searchcursor.js');\nrequire('codemirror/mode/gfm/gfm.js');\nrequire('codemirror/mode/xml/xml.js');\nvar CodeMirrorSpellChecker = require('codemirror-spell-checker');\nvar marked = require('marked');\n\n\n// Some variables\nvar isMac = /Mac/.test(navigator.platform);\nvar anchorToExternalRegex = new RegExp(/(<a.*?https?:\\/\\/.*?[^a]>)+?/g);\n\n// Mapping of actions that can be bound to keyboard shortcuts or toolbar buttons\nvar bindings = {\n    'toggleBold': toggleBold,\n    'toggleItalic': toggleItalic,\n    'drawLink': drawLink,\n    'toggleHeadingSmaller': toggleHeadingSmaller,\n    'toggleHeadingBigger': toggleHeadingBigger,\n    'drawImage': drawImage,\n    'toggleBlockquote': toggleBlockquote,\n    'toggleOrderedList': toggleOrderedList,\n    'toggleUnorderedList': toggleUnorderedList,\n    'toggleCodeBlock': toggleCodeBlock,\n    'togglePreview': togglePreview,\n    'toggleStrikethrough': toggleStrikethrough,\n    'toggleHeading1': toggleHeading1,\n    'toggleHeading2': toggleHeading2,\n    'toggleHeading3': toggleHeading3,\n    'cleanBlock': cleanBlock,\n    'drawTable': drawTable,\n    'drawHorizontalRule': drawHorizontalRule,\n    'undo': undo,\n    'redo': redo,\n    'toggleSideBySide': toggleSideBySide,\n    'toggleFullScreen': toggleFullScreen,\n};\n\nvar shortcuts = {\n    'toggleBold': 'Cmd-B',\n    'toggleItalic': 'Cmd-I',\n    'drawLink': 'Cmd-K',\n    'toggleHeadingSmaller': 'Cmd-H',\n    'toggleHeadingBigger': 'Shift-Cmd-H',\n    'cleanBlock': 'Cmd-E',\n    'drawImage': 'Cmd-Alt-I',\n    'toggleBlockquote': 'Cmd-\\'',\n    'toggleOrderedList': 'Cmd-Alt-L',\n    'toggleUnorderedList': 'Cmd-L',\n    'toggleCodeBlock': 'Cmd-Alt-C',\n    'togglePreview': 'Cmd-P',\n    'toggleSideBySide': 'F9',\n    'toggleFullScreen': 'F11',\n};\n\nvar getBindingName = function (f) {\n    for (var key in bindings) {\n        if (bindings[key] === f) {\n            return key;\n        }\n    }\n    return null;\n};\n\nvar isMobile = function () {\n    var check = false;\n    (function (a) {\n        if (/(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw-(n|u)|c55\\/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|g560|gene|gf-5|g-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk\\/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/i.test(a.substr(0, 4))) check = true;\n    })(navigator.userAgent || navigator.vendor || window.opera);\n    return check;\n};\n\n/**\n * Modify HTML to add 'target=\"_blank\"' to links so they open in new tabs by default.\n * @param {string} htmlText - HTML to be modified.\n * @return {string} The modified HTML text.\n */\nfunction addAnchorTargetBlank(htmlText) {\n    var match;\n    while ((match = anchorToExternalRegex.exec(htmlText)) !== null) {\n        // With only one capture group in the RegExp, we can safely take the first index from the match.\n        var linkString = match[0];\n\n        if (linkString.indexOf('target=') === -1) {\n            var fixedLinkString = linkString.replace(/>$/, ' target=\"_blank\">');\n            htmlText = htmlText.replace(linkString, fixedLinkString);\n        }\n    }\n    return htmlText;\n}\n\n\n/**\n * Fix shortcut. Mac use Command, others use Ctrl.\n */\nfunction fixShortcut(name) {\n    if (isMac) {\n        name = name.replace('Ctrl', 'Cmd');\n    } else {\n        name = name.replace('Cmd', 'Ctrl');\n    }\n    return name;\n}\n\n\n/**\n * Create button element for toolbar.\n */\nfunction createToolbarButton(options, enableTooltips, shortcuts) {\n    options = options || {};\n    var el = document.createElement('button');\n    el.className = options.name;\n    el.setAttribute('type', 'button');\n    enableTooltips = (enableTooltips == undefined) ? true : enableTooltips;\n\n    // Properly hande custom shortcuts\n    if (options.name && options.name in shortcuts) {\n        bindings[options.name] = options.action;\n    }\n\n    if (options.title && enableTooltips) {\n        el.title = createTooltip(options.title, options.action, shortcuts);\n\n        if (isMac) {\n            el.title = el.title.replace('Ctrl', '⌘');\n            el.title = el.title.replace('Alt', '⌥');\n        }\n    }\n\n    if (options.noDisable) {\n        el.classList.add('no-disable');\n    }\n\n    if (options.noMobile) {\n        el.classList.add('no-mobile');\n    }\n\n    // Provide backwards compatibility with simple-markdown-editor by adding custom classes to the button.\n    var classNameParts = options.className.split(' ');\n    var iconClasses = [];\n    for (var classNameIndex = 0; classNameIndex < classNameParts.length; classNameIndex++) {\n        var classNamePart = classNameParts[classNameIndex];\n        // Split icon classes from the button.\n        // Regex will detect \"fa\", \"fas\", \"fa-something\" and \"fa-some-icon-1\", but not \"fanfare\".\n        if (classNamePart.match(/^fa([srlb]|(-[\\w-]*)|$)/)) {\n            iconClasses.push(classNamePart);\n        } else {\n            el.classList.add(classNamePart);\n        }\n    }\n\n    el.tabIndex = -1;\n\n    // Create icon element and append as a child to the button\n    var icon = document.createElement('i');\n    for (var iconClassIndex = 0; iconClassIndex < iconClasses.length; iconClassIndex++) {\n        var iconClass = iconClasses[iconClassIndex];\n        icon.classList.add(iconClass);\n    }\n    el.appendChild(icon);\n\n    return el;\n}\n\nfunction createSep() {\n    var el = document.createElement('i');\n    el.className = 'separator';\n    el.innerHTML = '|';\n    return el;\n}\n\nfunction createTooltip(title, action, shortcuts) {\n    var actionName;\n    var tooltip = title;\n\n    if (action) {\n        actionName = getBindingName(action);\n        if (shortcuts[actionName]) {\n            tooltip += ' (' + fixShortcut(shortcuts[actionName]) + ')';\n        }\n    }\n\n    return tooltip;\n}\n\n/**\n * The state of CodeMirror at the given position.\n */\nfunction getState(cm, pos) {\n    pos = pos || cm.getCursor('start');\n    var stat = cm.getTokenAt(pos);\n    if (!stat.type) return {};\n\n    var types = stat.type.split(' ');\n\n    var ret = {},\n        data, text;\n    for (var i = 0; i < types.length; i++) {\n        data = types[i];\n        if (data === 'strong') {\n            ret.bold = true;\n        } else if (data === 'variable-2') {\n            text = cm.getLine(pos.line);\n            if (/^\\s*\\d+\\.\\s/.test(text)) {\n                ret['ordered-list'] = true;\n            } else {\n                ret['unordered-list'] = true;\n            }\n        } else if (data === 'atom') {\n            ret.quote = true;\n        } else if (data === 'em') {\n            ret.italic = true;\n        } else if (data === 'quote') {\n            ret.quote = true;\n        } else if (data === 'strikethrough') {\n            ret.strikethrough = true;\n        } else if (data === 'comment') {\n            ret.code = true;\n        } else if (data === 'link') {\n            ret.link = true;\n        } else if (data === 'tag') {\n            ret.image = true;\n        } else if (data.match(/^header(-[1-6])?$/)) {\n            ret[data.replace('header', 'heading')] = true;\n        }\n    }\n    return ret;\n}\n\n\n// Saved overflow setting\nvar saved_overflow = '';\n\n/**\n * Toggle full screen of the editor.\n */\nfunction toggleFullScreen(editor) {\n    // Set fullscreen\n    var cm = editor.codemirror;\n    cm.setOption('fullScreen', !cm.getOption('fullScreen'));\n\n\n    // Prevent scrolling on body during fullscreen active\n    if (cm.getOption('fullScreen')) {\n        saved_overflow = document.body.style.overflow;\n        document.body.style.overflow = 'hidden';\n    } else {\n        document.body.style.overflow = saved_overflow;\n    }\n\n\n    // Update toolbar class\n    var wrap = cm.getWrapperElement();\n\n    if (!/fullscreen/.test(wrap.previousSibling.className)) {\n        wrap.previousSibling.className += ' fullscreen';\n    } else {\n        wrap.previousSibling.className = wrap.previousSibling.className.replace(/\\s*fullscreen\\b/, '');\n    }\n\n\n    // Update toolbar button\n    if (editor.toolbarElements && editor.toolbarElements.fullscreen) {\n        var toolbarButton = editor.toolbarElements.fullscreen;\n\n        if (!/active/.test(toolbarButton.className)) {\n            toolbarButton.className += ' active';\n        } else {\n            toolbarButton.className = toolbarButton.className.replace(/\\s*active\\s*/g, '');\n        }\n    }\n\n\n    // Hide side by side if needed\n    var sidebyside = cm.getWrapperElement().nextSibling;\n    if (/editor-preview-active-side/.test(sidebyside.className))\n        toggleSideBySide(editor);\n\n    if (editor.options.onToggleFullScreen) {\n        editor.options.onToggleFullScreen(cm.getOption('fullScreen') || false);\n    }\n}\n\n\n/**\n * Action for toggling bold.\n */\nfunction toggleBold(editor) {\n    _toggleBlock(editor, 'bold', editor.options.blockStyles.bold);\n}\n\n\n/**\n * Action for toggling italic.\n */\nfunction toggleItalic(editor) {\n    _toggleBlock(editor, 'italic', editor.options.blockStyles.italic);\n}\n\n\n/**\n * Action for toggling strikethrough.\n */\nfunction toggleStrikethrough(editor) {\n    _toggleBlock(editor, 'strikethrough', '~~');\n}\n\n/**\n * Action for toggling code block.\n */\nfunction toggleCodeBlock(editor) {\n    var fenceCharsToInsert = editor.options.blockStyles.code;\n\n    function fencing_line(line) {\n        /* return true, if this is a ``` or ~~~ line */\n        if (typeof line !== 'object') {\n            throw 'fencing_line() takes a \\'line\\' object (not a line number, or line text).  Got: ' + typeof line + ': ' + line;\n        }\n        return line.styles && line.styles[2] && line.styles[2].indexOf('formatting-code-block') !== -1;\n    }\n\n    function token_state(token) {\n        // base goes an extra level deep when mode backdrops are used, e.g. spellchecker on\n        return token.state.base.base || token.state.base;\n    }\n\n    function code_type(cm, line_num, line, firstTok, lastTok) {\n        /*\n         * Return \"single\", \"indented\", \"fenced\" or false\n         *\n         * cm and line_num are required.  Others are optional for efficiency\n         *   To check in the middle of a line, pass in firstTok yourself.\n         */\n        line = line || cm.getLineHandle(line_num);\n        firstTok = firstTok || cm.getTokenAt({\n            line: line_num,\n            ch: 1,\n        });\n        lastTok = lastTok || (!!line.text && cm.getTokenAt({\n            line: line_num,\n            ch: line.text.length - 1,\n        }));\n        var types = firstTok.type ? firstTok.type.split(' ') : [];\n        if (lastTok && token_state(lastTok).indentedCode) {\n            // have to check last char, since first chars of first line aren\"t marked as indented\n            return 'indented';\n        } else if (types.indexOf('comment') === -1) {\n            // has to be after \"indented\" check, since first chars of first indented line aren\"t marked as such\n            return false;\n        } else if (token_state(firstTok).fencedChars || token_state(lastTok).fencedChars || fencing_line(line)) {\n            return 'fenced';\n        } else {\n            return 'single';\n        }\n    }\n\n    function insertFencingAtSelection(cm, cur_start, cur_end, fenceCharsToInsert) {\n        var start_line_sel = cur_start.line + 1,\n            end_line_sel = cur_end.line + 1,\n            sel_multi = cur_start.line !== cur_end.line,\n            repl_start = fenceCharsToInsert + '\\n',\n            repl_end = '\\n' + fenceCharsToInsert;\n        if (sel_multi) {\n            end_line_sel++;\n        }\n        // handle last char including \\n or not\n        if (sel_multi && cur_end.ch === 0) {\n            repl_end = fenceCharsToInsert + '\\n';\n            end_line_sel--;\n        }\n        _replaceSelection(cm, false, [repl_start, repl_end]);\n        cm.setSelection({\n            line: start_line_sel,\n            ch: 0,\n        }, {\n            line: end_line_sel,\n            ch: 0,\n        });\n    }\n\n    var cm = editor.codemirror,\n        cur_start = cm.getCursor('start'),\n        cur_end = cm.getCursor('end'),\n        tok = cm.getTokenAt({\n            line: cur_start.line,\n            ch: cur_start.ch || 1,\n        }), // avoid ch 0 which is a cursor pos but not token\n        line = cm.getLineHandle(cur_start.line),\n        is_code = code_type(cm, cur_start.line, line, tok);\n    var block_start, block_end, lineCount;\n\n    if (is_code === 'single') {\n        // similar to some EasyMDE _toggleBlock logic\n        var start = line.text.slice(0, cur_start.ch).replace('`', ''),\n            end = line.text.slice(cur_start.ch).replace('`', '');\n        cm.replaceRange(start + end, {\n            line: cur_start.line,\n            ch: 0,\n        }, {\n            line: cur_start.line,\n            ch: 99999999999999,\n        });\n        cur_start.ch--;\n        if (cur_start !== cur_end) {\n            cur_end.ch--;\n        }\n        cm.setSelection(cur_start, cur_end);\n        cm.focus();\n    } else if (is_code === 'fenced') {\n        if (cur_start.line !== cur_end.line || cur_start.ch !== cur_end.ch) {\n            // use selection\n\n            // find the fenced line so we know what type it is (tilde, backticks, number of them)\n            for (block_start = cur_start.line; block_start >= 0; block_start--) {\n                line = cm.getLineHandle(block_start);\n                if (fencing_line(line)) {\n                    break;\n                }\n            }\n            var fencedTok = cm.getTokenAt({\n                line: block_start,\n                ch: 1,\n            });\n            var fence_chars = token_state(fencedTok).fencedChars;\n            var start_text, start_line;\n            var end_text, end_line;\n            // check for selection going up against fenced lines, in which case we don't want to add more fencing\n            if (fencing_line(cm.getLineHandle(cur_start.line))) {\n                start_text = '';\n                start_line = cur_start.line;\n            } else if (fencing_line(cm.getLineHandle(cur_start.line - 1))) {\n                start_text = '';\n                start_line = cur_start.line - 1;\n            } else {\n                start_text = fence_chars + '\\n';\n                start_line = cur_start.line;\n            }\n            if (fencing_line(cm.getLineHandle(cur_end.line))) {\n                end_text = '';\n                end_line = cur_end.line;\n                if (cur_end.ch === 0) {\n                    end_line += 1;\n                }\n            } else if (cur_end.ch !== 0 && fencing_line(cm.getLineHandle(cur_end.line + 1))) {\n                end_text = '';\n                end_line = cur_end.line + 1;\n            } else {\n                end_text = fence_chars + '\\n';\n                end_line = cur_end.line + 1;\n            }\n            if (cur_end.ch === 0) {\n                // full last line selected, putting cursor at beginning of next\n                end_line -= 1;\n            }\n            cm.operation(function () {\n                // end line first, so that line numbers don't change\n                cm.replaceRange(end_text, {\n                    line: end_line,\n                    ch: 0,\n                }, {\n                    line: end_line + (end_text ? 0 : 1),\n                    ch: 0,\n                });\n                cm.replaceRange(start_text, {\n                    line: start_line,\n                    ch: 0,\n                }, {\n                    line: start_line + (start_text ? 0 : 1),\n                    ch: 0,\n                });\n            });\n            cm.setSelection({\n                line: start_line + (start_text ? 1 : 0),\n                ch: 0,\n            }, {\n                line: end_line + (start_text ? 1 : -1),\n                ch: 0,\n            });\n            cm.focus();\n        } else {\n            // no selection, search for ends of this fenced block\n            var search_from = cur_start.line;\n            if (fencing_line(cm.getLineHandle(cur_start.line))) { // gets a little tricky if cursor is right on a fenced line\n                if (code_type(cm, cur_start.line + 1) === 'fenced') {\n                    block_start = cur_start.line;\n                    search_from = cur_start.line + 1; // for searching for \"end\"\n                } else {\n                    block_end = cur_start.line;\n                    search_from = cur_start.line - 1; // for searching for \"start\"\n                }\n            }\n            if (block_start === undefined) {\n                for (block_start = search_from; block_start >= 0; block_start--) {\n                    line = cm.getLineHandle(block_start);\n                    if (fencing_line(line)) {\n                        break;\n                    }\n                }\n            }\n            if (block_end === undefined) {\n                lineCount = cm.lineCount();\n                for (block_end = search_from; block_end < lineCount; block_end++) {\n                    line = cm.getLineHandle(block_end);\n                    if (fencing_line(line)) {\n                        break;\n                    }\n                }\n            }\n            cm.operation(function () {\n                cm.replaceRange('', {\n                    line: block_start,\n                    ch: 0,\n                }, {\n                    line: block_start + 1,\n                    ch: 0,\n                });\n                cm.replaceRange('', {\n                    line: block_end - 1,\n                    ch: 0,\n                }, {\n                    line: block_end,\n                    ch: 0,\n                });\n            });\n            cm.focus();\n        }\n    } else if (is_code === 'indented') {\n        if (cur_start.line !== cur_end.line || cur_start.ch !== cur_end.ch) {\n            // use selection\n            block_start = cur_start.line;\n            block_end = cur_end.line;\n            if (cur_end.ch === 0) {\n                block_end--;\n            }\n        } else {\n            // no selection, search for ends of this indented block\n            for (block_start = cur_start.line; block_start >= 0; block_start--) {\n                line = cm.getLineHandle(block_start);\n                if (line.text.match(/^\\s*$/)) {\n                    // empty or all whitespace - keep going\n                    continue;\n                } else {\n                    if (code_type(cm, block_start, line) !== 'indented') {\n                        block_start += 1;\n                        break;\n                    }\n                }\n            }\n            lineCount = cm.lineCount();\n            for (block_end = cur_start.line; block_end < lineCount; block_end++) {\n                line = cm.getLineHandle(block_end);\n                if (line.text.match(/^\\s*$/)) {\n                    // empty or all whitespace - keep going\n                    continue;\n                } else {\n                    if (code_type(cm, block_end, line) !== 'indented') {\n                        block_end -= 1;\n                        break;\n                    }\n                }\n            }\n        }\n        // if we are going to un-indent based on a selected set of lines, and the next line is indented too, we need to\n        // insert a blank line so that the next line(s) continue to be indented code\n        var next_line = cm.getLineHandle(block_end + 1),\n            next_line_last_tok = next_line && cm.getTokenAt({\n                line: block_end + 1,\n                ch: next_line.text.length - 1,\n            }),\n            next_line_indented = next_line_last_tok && token_state(next_line_last_tok).indentedCode;\n        if (next_line_indented) {\n            cm.replaceRange('\\n', {\n                line: block_end + 1,\n                ch: 0,\n            });\n        }\n\n        for (var i = block_start; i <= block_end; i++) {\n            cm.indentLine(i, 'subtract'); // TODO: this doesn't get tracked in the history, so can't be undone :(\n        }\n        cm.focus();\n    } else {\n        // insert code formatting\n        var no_sel_and_starting_of_line = (cur_start.line === cur_end.line && cur_start.ch === cur_end.ch && cur_start.ch === 0);\n        var sel_multi = cur_start.line !== cur_end.line;\n        if (no_sel_and_starting_of_line || sel_multi) {\n            insertFencingAtSelection(cm, cur_start, cur_end, fenceCharsToInsert);\n        } else {\n            _replaceSelection(cm, false, ['`', '`']);\n        }\n    }\n}\n\n/**\n * Action for toggling blockquote.\n */\nfunction toggleBlockquote(editor) {\n    var cm = editor.codemirror;\n    _toggleLine(cm, 'quote');\n}\n\n/**\n * Action for toggling heading size: normal -> h1 -> h2 -> h3 -> h4 -> h5 -> h6 -> normal\n */\nfunction toggleHeadingSmaller(editor) {\n    var cm = editor.codemirror;\n    _toggleHeading(cm, 'smaller');\n}\n\n/**\n * Action for toggling heading size: normal -> h6 -> h5 -> h4 -> h3 -> h2 -> h1 -> normal\n */\nfunction toggleHeadingBigger(editor) {\n    var cm = editor.codemirror;\n    _toggleHeading(cm, 'bigger');\n}\n\n/**\n * Action for toggling heading size 1\n */\nfunction toggleHeading1(editor) {\n    var cm = editor.codemirror;\n    _toggleHeading(cm, undefined, 1);\n}\n\n/**\n * Action for toggling heading size 2\n */\nfunction toggleHeading2(editor) {\n    var cm = editor.codemirror;\n    _toggleHeading(cm, undefined, 2);\n}\n\n/**\n * Action for toggling heading size 3\n */\nfunction toggleHeading3(editor) {\n    var cm = editor.codemirror;\n    _toggleHeading(cm, undefined, 3);\n}\n\n\n/**\n * Action for toggling ul.\n */\nfunction toggleUnorderedList(editor) {\n    var cm = editor.codemirror;\n    _toggleLine(cm, 'unordered-list');\n}\n\n\n/**\n * Action for toggling ol.\n */\nfunction toggleOrderedList(editor) {\n    var cm = editor.codemirror;\n    _toggleLine(cm, 'ordered-list');\n}\n\n/**\n * Action for clean block (remove headline, list, blockquote code, markers)\n */\nfunction cleanBlock(editor) {\n    var cm = editor.codemirror;\n    _cleanBlock(cm);\n}\n\n/**\n * Action for drawing a link.\n */\nfunction drawLink(editor) {\n    var cm = editor.codemirror;\n    var stat = getState(cm);\n    var options = editor.options;\n    var url = 'https://';\n    if (options.promptURLs) {\n        url = prompt(options.promptTexts.link, 'https://');\n        if (!url) {\n            return false;\n        }\n    }\n    _replaceSelection(cm, stat.link, options.insertTexts.link, url);\n}\n\n/**\n * Action for drawing an img.\n */\nfunction drawImage(editor) {\n    var cm = editor.codemirror;\n    var stat = getState(cm);\n    var options = editor.options;\n    var url = 'https://';\n    if (options.promptURLs) {\n        url = prompt(options.promptTexts.image, 'https://');\n        if (!url) {\n            return false;\n        }\n    }\n    _replaceSelection(cm, stat.image, options.insertTexts.image, url);\n}\n\n/**\n * Action for opening the browse-file window to upload an image to a server.\n * @param editor {EasyMDE} The EasyMDE object\n */\nfunction drawUploadedImage(editor) {\n    // TODO: Draw the image template with a fake url? ie: '![](importing foo.png...)'\n    editor.openBrowseFileWindow();\n}\n\n/**\n * Action executed after an image have been successfully imported on the server.\n * @param editor {EasyMDE} The EasyMDE object\n * @param url {string} The url of the uploaded image\n */\nfunction afterImageUploaded(editor, url) {\n    var cm = editor.codemirror;\n    var stat = getState(cm);\n    var options = editor.options;\n    var imageName = url.substr(url.lastIndexOf('/') + 1);\n    _replaceSelection(cm, stat.image, options.insertTexts.uploadedImage, url);\n    // show uploaded image filename for 1000ms\n    editor.updateStatusBar('upload-image', editor.options.imageTexts.sbOnUploaded.replace('#image_name#', imageName));\n    setTimeout(function () {\n        editor.updateStatusBar('upload-image', editor.options.imageTexts.sbInit);\n    }, 1000);\n}\n\n/**\n * Action for drawing a table.\n */\nfunction drawTable(editor) {\n    var cm = editor.codemirror;\n    var stat = getState(cm);\n    var options = editor.options;\n    _replaceSelection(cm, stat.table, options.insertTexts.table);\n}\n\n/**\n * Action for drawing a horizontal rule.\n */\nfunction drawHorizontalRule(editor) {\n    var cm = editor.codemirror;\n    var stat = getState(cm);\n    var options = editor.options;\n    _replaceSelection(cm, stat.image, options.insertTexts.horizontalRule);\n}\n\n\n/**\n * Undo action.\n */\nfunction undo(editor) {\n    var cm = editor.codemirror;\n    cm.undo();\n    cm.focus();\n}\n\n\n/**\n * Redo action.\n */\nfunction redo(editor) {\n    var cm = editor.codemirror;\n    cm.redo();\n    cm.focus();\n}\n\n\n/**\n * Toggle side by side preview\n */\nfunction toggleSideBySide(editor) {\n    var cm = editor.codemirror;\n    var wrapper = cm.getWrapperElement();\n    var preview = wrapper.nextSibling;\n    var toolbarButton = editor.toolbarElements && editor.toolbarElements['side-by-side'];\n    var useSideBySideListener = false;\n    if (/editor-preview-active-side/.test(preview.className)) {\n        preview.className = preview.className.replace(\n            /\\s*editor-preview-active-side\\s*/g, ''\n        );\n        if (toolbarButton) toolbarButton.className = toolbarButton.className.replace(/\\s*active\\s*/g, '');\n        wrapper.className = wrapper.className.replace(/\\s*CodeMirror-sided\\s*/g, ' ');\n    } else {\n        // When the preview button is clicked for the first time,\n        // give some time for the transition from editor.css to fire and the view to slide from right to left,\n        // instead of just appearing.\n        setTimeout(function () {\n            if (!cm.getOption('fullScreen'))\n                toggleFullScreen(editor);\n            preview.className += ' editor-preview-active-side';\n        }, 1);\n        if (toolbarButton) toolbarButton.className += ' active';\n        wrapper.className += ' CodeMirror-sided';\n        useSideBySideListener = true;\n    }\n\n    // Hide normal preview if active\n    var previewNormal = wrapper.lastChild;\n    if (/editor-preview-active/.test(previewNormal.className)) {\n        previewNormal.className = previewNormal.className.replace(\n            /\\s*editor-preview-active\\s*/g, ''\n        );\n        var toolbar = editor.toolbarElements.preview;\n        var toolbar_div = wrapper.previousSibling;\n        toolbar.className = toolbar.className.replace(/\\s*active\\s*/g, '');\n        toolbar_div.className = toolbar_div.className.replace(/\\s*disabled-for-preview*/g, '');\n    }\n\n    var sideBySideRenderingFunction = function () {\n        var newValue = editor.options.previewRender(editor.value(), preview);\n        if (newValue != null) {\n            preview.innerHTML = newValue;\n        }\n    };\n\n    if (!cm.sideBySideRenderingFunction) {\n        cm.sideBySideRenderingFunction = sideBySideRenderingFunction;\n    }\n\n    if (useSideBySideListener) {\n        var newValue = editor.options.previewRender(editor.value(), preview);\n        if (newValue != null) {\n            preview.innerHTML = newValue;\n        }\n        cm.on('update', cm.sideBySideRenderingFunction);\n    } else {\n        cm.off('update', cm.sideBySideRenderingFunction);\n    }\n\n    // Refresh to fix selection being off (#309)\n    cm.refresh();\n}\n\n\n/**\n * Preview action.\n */\nfunction togglePreview(editor) {\n    var cm = editor.codemirror;\n    var wrapper = cm.getWrapperElement();\n    var toolbar_div = wrapper.previousSibling;\n    var toolbar = editor.options.toolbar ? editor.toolbarElements.preview : false;\n    var preview = wrapper.lastChild;\n    if (!preview || !/editor-preview-full/.test(preview.className)) {\n\n        preview = document.createElement('div');\n        preview.className = 'editor-preview-full';\n\n        if (editor.options.previewClass) {\n\n            if (Array.isArray(editor.options.previewClass)) {\n                for (var i = 0; i < editor.options.previewClass.length; i++) {\n                    preview.className += (' ' + editor.options.previewClass[i]);\n                }\n\n            } else if (typeof editor.options.previewClass === 'string') {\n                preview.className += (' ' + editor.options.previewClass);\n            }\n        }\n\n        wrapper.appendChild(preview);\n    }\n    if (/editor-preview-active/.test(preview.className)) {\n        preview.className = preview.className.replace(\n            /\\s*editor-preview-active\\s*/g, ''\n        );\n        if (toolbar) {\n            toolbar.className = toolbar.className.replace(/\\s*active\\s*/g, '');\n            toolbar_div.className = toolbar_div.className.replace(/\\s*disabled-for-preview*/g, '');\n        }\n    } else {\n        // When the preview button is clicked for the first time,\n        // give some time for the transition from editor.css to fire and the view to slide from right to left,\n        // instead of just appearing.\n        setTimeout(function () {\n            preview.className += ' editor-preview-active';\n        }, 1);\n        if (toolbar) {\n            toolbar.className += ' active';\n            toolbar_div.className += ' disabled-for-preview';\n        }\n    }\n    preview.innerHTML = editor.options.previewRender(editor.value(), preview);\n\n    // Turn off side by side if needed\n    var sidebyside = cm.getWrapperElement().nextSibling;\n    if (/editor-preview-active-side/.test(sidebyside.className))\n        toggleSideBySide(editor);\n}\n\nfunction _replaceSelection(cm, active, startEnd, url) {\n    if (/editor-preview-active/.test(cm.getWrapperElement().lastChild.className))\n        return;\n\n    var text;\n    var start = startEnd[0];\n    var end = startEnd[1];\n    var startPoint = {},\n        endPoint = {};\n    Object.assign(startPoint, cm.getCursor('start'));\n    Object.assign(endPoint, cm.getCursor('end'));\n    if (url) {\n        start = start.replace('#url#', url);  // url is in start for upload-image\n        end = end.replace('#url#', url);\n    }\n    if (active) {\n        text = cm.getLine(startPoint.line);\n        start = text.slice(0, startPoint.ch);\n        end = text.slice(startPoint.ch);\n        cm.replaceRange(start + end, {\n            line: startPoint.line,\n            ch: 0,\n        });\n    } else {\n        text = cm.getSelection();\n        cm.replaceSelection(start + text + end);\n\n        startPoint.ch += start.length;\n        if (startPoint !== endPoint) {\n            endPoint.ch += start.length;\n        }\n    }\n    cm.setSelection(startPoint, endPoint);\n    cm.focus();\n}\n\n\nfunction _toggleHeading(cm, direction, size) {\n    if (/editor-preview-active/.test(cm.getWrapperElement().lastChild.className))\n        return;\n\n    var startPoint = cm.getCursor('start');\n    var endPoint = cm.getCursor('end');\n    for (var i = startPoint.line; i <= endPoint.line; i++) {\n        (function (i) {\n            var text = cm.getLine(i);\n            var currHeadingLevel = text.search(/[^#]/);\n\n            if (direction !== undefined) {\n                if (currHeadingLevel <= 0) {\n                    if (direction == 'bigger') {\n                        text = '###### ' + text;\n                    } else {\n                        text = '# ' + text;\n                    }\n                } else if (currHeadingLevel == 6 && direction == 'smaller') {\n                    text = text.substr(7);\n                } else if (currHeadingLevel == 1 && direction == 'bigger') {\n                    text = text.substr(2);\n                } else {\n                    if (direction == 'bigger') {\n                        text = text.substr(1);\n                    } else {\n                        text = '#' + text;\n                    }\n                }\n            } else {\n                if (size == 1) {\n                    if (currHeadingLevel <= 0) {\n                        text = '# ' + text;\n                    } else if (currHeadingLevel == size) {\n                        text = text.substr(currHeadingLevel + 1);\n                    } else {\n                        text = '# ' + text.substr(currHeadingLevel + 1);\n                    }\n                } else if (size == 2) {\n                    if (currHeadingLevel <= 0) {\n                        text = '## ' + text;\n                    } else if (currHeadingLevel == size) {\n                        text = text.substr(currHeadingLevel + 1);\n                    } else {\n                        text = '## ' + text.substr(currHeadingLevel + 1);\n                    }\n                } else {\n                    if (currHeadingLevel <= 0) {\n                        text = '### ' + text;\n                    } else if (currHeadingLevel == size) {\n                        text = text.substr(currHeadingLevel + 1);\n                    } else {\n                        text = '### ' + text.substr(currHeadingLevel + 1);\n                    }\n                }\n            }\n\n            cm.replaceRange(text, {\n                line: i,\n                ch: 0,\n            }, {\n                line: i,\n                ch: 99999999999999,\n            });\n        })(i);\n    }\n    cm.focus();\n}\n\n\nfunction _toggleLine(cm, name) {\n    if (/editor-preview-active/.test(cm.getWrapperElement().lastChild.className))\n        return;\n\n    var listRegexp = /^(\\s*)(\\*|-|\\+|\\d*\\.)(\\s+)/;\n    var whitespacesRegexp = /^\\s*/;\n\n    var stat = getState(cm);\n    var startPoint = cm.getCursor('start');\n    var endPoint = cm.getCursor('end');\n    var repl = {\n        'quote': /^(\\s*)>\\s+/,\n        'unordered-list': listRegexp,\n        'ordered-list': listRegexp,\n    };\n\n    var _getChar = function (name, i) {\n        var map = {\n            'quote': '>',\n            'unordered-list': '*',\n            'ordered-list': '%%i.',\n        };\n\n        return map[name].replace('%%i', i);\n    };\n\n    var _checkChar = function (name, char) {\n        var map = {\n            'quote': '>',\n            'unordered-list': '*',\n            'ordered-list': '\\\\d+.',\n        };\n        var rt = new RegExp(map[name]);\n\n        return char && rt.test(char);\n    };\n\n    var _toggle = function (name, text, untoggleOnly) {\n        var arr = listRegexp.exec(text);\n        var char = _getChar(name, line);\n        if (arr !== null) {\n            if (_checkChar(name, arr[2])) {\n                char = '';\n            }\n            text = arr[1] + char + arr[3] + text.replace(whitespacesRegexp, '').replace(repl[name], '$1');\n        } else if (untoggleOnly == false) {\n            text = char + ' ' + text;\n        }\n        return text;\n    };\n\n    var line = 1;\n    for (var i = startPoint.line; i <= endPoint.line; i++) {\n        (function (i) {\n            var text = cm.getLine(i);\n            if (stat[name]) {\n                text = text.replace(repl[name], '$1');\n            } else {\n                // If we're toggling unordered-list formatting, check if the current line\n                // is part of an ordered-list, and if so, untoggle that first.\n                // Workaround for https://github.com/Ionaru/easy-markdown-editor/issues/92\n                if (name == 'unordered-list') {\n                    text = _toggle('ordered-list', text, true);\n                }\n                text = _toggle(name, text, false);\n                line += 1;\n            }\n            cm.replaceRange(text, {\n                line: i,\n                ch: 0,\n            }, {\n                line: i,\n                ch: 99999999999999,\n            });\n        })(i);\n    }\n    cm.focus();\n}\n\nfunction _toggleBlock(editor, type, start_chars, end_chars) {\n    if (/editor-preview-active/.test(editor.codemirror.getWrapperElement().lastChild.className))\n        return;\n\n    end_chars = (typeof end_chars === 'undefined') ? start_chars : end_chars;\n    var cm = editor.codemirror;\n    var stat = getState(cm);\n\n    var text;\n    var start = start_chars;\n    var end = end_chars;\n\n    var startPoint = cm.getCursor('start');\n    var endPoint = cm.getCursor('end');\n\n    if (stat[type]) {\n        text = cm.getLine(startPoint.line);\n        start = text.slice(0, startPoint.ch);\n        end = text.slice(startPoint.ch);\n        if (type == 'bold') {\n            start = start.replace(/(\\*\\*|__)(?![\\s\\S]*(\\*\\*|__))/, '');\n            end = end.replace(/(\\*\\*|__)/, '');\n        } else if (type == 'italic') {\n            start = start.replace(/(\\*|_)(?![\\s\\S]*(\\*|_))/, '');\n            end = end.replace(/(\\*|_)/, '');\n        } else if (type == 'strikethrough') {\n            start = start.replace(/(\\*\\*|~~)(?![\\s\\S]*(\\*\\*|~~))/, '');\n            end = end.replace(/(\\*\\*|~~)/, '');\n        }\n        cm.replaceRange(start + end, {\n            line: startPoint.line,\n            ch: 0,\n        }, {\n            line: startPoint.line,\n            ch: 99999999999999,\n        });\n\n        if (type == 'bold' || type == 'strikethrough') {\n            startPoint.ch -= 2;\n            if (startPoint !== endPoint) {\n                endPoint.ch -= 2;\n            }\n        } else if (type == 'italic') {\n            startPoint.ch -= 1;\n            if (startPoint !== endPoint) {\n                endPoint.ch -= 1;\n            }\n        }\n    } else {\n        text = cm.getSelection();\n        if (type == 'bold') {\n            text = text.split('**').join('');\n            text = text.split('__').join('');\n        } else if (type == 'italic') {\n            text = text.split('*').join('');\n            text = text.split('_').join('');\n        } else if (type == 'strikethrough') {\n            text = text.split('~~').join('');\n        }\n        cm.replaceSelection(start + text + end);\n\n        startPoint.ch += start_chars.length;\n        endPoint.ch = startPoint.ch + text.length;\n    }\n\n    cm.setSelection(startPoint, endPoint);\n    cm.focus();\n}\n\nfunction _cleanBlock(cm) {\n    if (/editor-preview-active/.test(cm.getWrapperElement().lastChild.className))\n        return;\n\n    var startPoint = cm.getCursor('start');\n    var endPoint = cm.getCursor('end');\n    var text;\n\n    for (var line = startPoint.line; line <= endPoint.line; line++) {\n        text = cm.getLine(line);\n        text = text.replace(/^[ ]*([# ]+|\\*|-|[> ]+|[0-9]+(.|\\)))[ ]*/, '');\n\n        cm.replaceRange(text, {\n            line: line,\n            ch: 0,\n        }, {\n            line: line,\n            ch: 99999999999999,\n        });\n    }\n}\n\n/**\n * Convert a number of bytes to a human-readable file size.\n * @param bytes {integer} A number of bytes, as integer. Ex: 421137\n * @param units {number[]} An array of human-readable units, ie. ['b', 'Kb', 'Mb']\n * @returns string A human-readable file size. Ex: '412Kb'\n */\nfunction humanFileSize(bytes, units) {\n    if (Math.abs(bytes) < 1024) {\n        return '' + bytes + units[0];\n    }\n    var u = 0;\n    do {\n        bytes /= 1024;\n        ++u;\n    } while (Math.abs(bytes) >= 1024 && u < units.length);\n    return '' + bytes.toFixed(1) + units[u];\n}\n\n// Merge the properties of one object into another.\nfunction _mergeProperties(target, source) {\n    for (var property in source) {\n        if (Object.prototype.hasOwnProperty.call(source, property)) {\n            if (source[property] instanceof Array) {\n                target[property] = source[property].concat(target[property] instanceof Array ? target[property] : []);\n            } else if (\n                source[property] !== null &&\n                typeof source[property] === 'object' &&\n                source[property].constructor === Object\n            ) {\n                target[property] = _mergeProperties(target[property] || {}, source[property]);\n            } else {\n                target[property] = source[property];\n            }\n        }\n    }\n\n    return target;\n}\n\n// Merge an arbitrary number of objects into one.\nfunction extend(target) {\n    for (var i = 1; i < arguments.length; i++) {\n        target = _mergeProperties(target, arguments[i]);\n    }\n\n    return target;\n}\n\n/* The right word count in respect for CJK. */\nfunction wordCount(data) {\n    var pattern = /[a-zA-Z0-9_\\u00A0-\\u02AF\\u0392-\\u03c9\\u0410-\\u04F9]+|[\\u4E00-\\u9FFF\\u3400-\\u4dbf\\uf900-\\ufaff\\u3040-\\u309f\\uac00-\\ud7af]+/g;\n    var m = data.match(pattern);\n    var count = 0;\n    if (m === null) return count;\n    for (var i = 0; i < m.length; i++) {\n        if (m[i].charCodeAt(0) >= 0x4E00) {\n            count += m[i].length;\n        } else {\n            count += 1;\n        }\n    }\n    return count;\n}\n\nvar toolbarBuiltInButtons = {\n    'bold': {\n        name: 'bold',\n        action: toggleBold,\n        className: 'fa fa-bold',\n        title: 'Bold',\n        default: true,\n    },\n    'italic': {\n        name: 'italic',\n        action: toggleItalic,\n        className: 'fa fa-italic',\n        title: 'Italic',\n        default: true,\n    },\n    'strikethrough': {\n        name: 'strikethrough',\n        action: toggleStrikethrough,\n        className: 'fa fa-strikethrough',\n        title: 'Strikethrough',\n    },\n    'heading': {\n        name: 'heading',\n        action: toggleHeadingSmaller,\n        className: 'fa fa-header fa-heading',\n        title: 'Heading',\n        default: true,\n    },\n    'heading-smaller': {\n        name: 'heading-smaller',\n        action: toggleHeadingSmaller,\n        className: 'fa fa-header fa-heading header-smaller',\n        title: 'Smaller Heading',\n    },\n    'heading-bigger': {\n        name: 'heading-bigger',\n        action: toggleHeadingBigger,\n        className: 'fa fa-header fa-heading header-bigger',\n        title: 'Bigger Heading',\n    },\n    'heading-1': {\n        name: 'heading-1',\n        action: toggleHeading1,\n        className: 'fa fa-header fa-heading header-1',\n        title: 'Big Heading',\n    },\n    'heading-2': {\n        name: 'heading-2',\n        action: toggleHeading2,\n        className: 'fa fa-header fa-heading header-2',\n        title: 'Medium Heading',\n    },\n    'heading-3': {\n        name: 'heading-3',\n        action: toggleHeading3,\n        className: 'fa fa-header fa-heading header-3',\n        title: 'Small Heading',\n    },\n    'separator-1': {\n        name: 'separator-1',\n    },\n    'code': {\n        name: 'code',\n        action: toggleCodeBlock,\n        className: 'fa fa-code',\n        title: 'Code',\n    },\n    'quote': {\n        name: 'quote',\n        action: toggleBlockquote,\n        className: 'fa fa-quote-left',\n        title: 'Quote',\n        default: true,\n    },\n    'unordered-list': {\n        name: 'unordered-list',\n        action: toggleUnorderedList,\n        className: 'fa fa-list-ul',\n        title: 'Generic List',\n        default: true,\n    },\n    'ordered-list': {\n        name: 'ordered-list',\n        action: toggleOrderedList,\n        className: 'fa fa-list-ol',\n        title: 'Numbered List',\n        default: true,\n    },\n    'clean-block': {\n        name: 'clean-block',\n        action: cleanBlock,\n        className: 'fa fa-eraser',\n        title: 'Clean block',\n    },\n    'separator-2': {\n        name: 'separator-2',\n    },\n    'link': {\n        name: 'link',\n        action: drawLink,\n        className: 'fa fa-link',\n        title: 'Create Link',\n        default: true,\n    },\n    'image': {\n        name: 'image',\n        action: drawImage,\n        className: 'fa fa-image',\n        title: 'Insert Image',\n        default: true,\n    },\n    'upload-image': {\n        name: 'upload-image',\n        action: drawUploadedImage,\n        className: 'fa fa-image',\n        title: 'Import an image',\n    },\n    'table': {\n        name: 'table',\n        action: drawTable,\n        className: 'fa fa-table',\n        title: 'Insert Table',\n    },\n    'horizontal-rule': {\n        name: 'horizontal-rule',\n        action: drawHorizontalRule,\n        className: 'fa fa-minus',\n        title: 'Insert Horizontal Line',\n    },\n    'separator-3': {\n        name: 'separator-3',\n    },\n    'preview': {\n        name: 'preview',\n        action: togglePreview,\n        className: 'fa fa-eye',\n        noDisable: true,\n        title: 'Toggle Preview',\n        default: true,\n    },\n    'side-by-side': {\n        name: 'side-by-side',\n        action: toggleSideBySide,\n        className: 'fa fa-columns',\n        noDisable: true,\n        noMobile: true,\n        title: 'Toggle Side by Side',\n        default: true,\n    },\n    'fullscreen': {\n        name: 'fullscreen',\n        action: toggleFullScreen,\n        className: 'fa fa-arrows-alt',\n        noDisable: true,\n        noMobile: true,\n        title: 'Toggle Fullscreen',\n        default: true,\n    },\n    'separator-4': {\n        name: 'separator-4',\n    },\n    'guide': {\n        name: 'guide',\n        action: 'https://www.markdownguide.org/basic-syntax/',\n        className: 'fa fa-question-circle',\n        noDisable: true,\n        title: 'Markdown Guide',\n        default: true,\n    },\n    'separator-5': {\n        name: 'separator-5',\n    },\n    'undo': {\n        name: 'undo',\n        action: undo,\n        className: 'fa fa-undo',\n        noDisable: true,\n        title: 'Undo',\n    },\n    'redo': {\n        name: 'redo',\n        action: redo,\n        className: 'fa fa-repeat fa-redo',\n        noDisable: true,\n        title: 'Redo',\n    },\n};\n\nvar insertTexts = {\n    link: ['[', '](#url#)'],\n    image: ['![](', '#url#)'],\n    uploadedImage: ['![](#url#)', ''],\n    // uploadedImage: ['![](#url#)\\n', ''], // TODO: New line insertion doesn't work here.\n    table: ['', '\\n\\n| Column 1 | Column 2 | Column 3 |\\n| -------- | -------- | -------- |\\n| Text     | Text     | Text     |\\n\\n'],\n    horizontalRule: ['', '\\n\\n-----\\n\\n'],\n};\n\nvar promptTexts = {\n    link: 'URL for the link:',\n    image: 'URL of the image:',\n};\n\nvar blockStyles = {\n    'bold': '**',\n    'code': '```',\n    'italic': '*',\n};\n\n/**\n * Texts displayed to the user (mainly on the status bar) for the import image\n * feature. Can be used for customization or internationalization.\n */\nvar imageTexts = {\n    sbInit: 'Attach files by drag and dropping or pasting from clipboard.',\n    sbOnDragEnter: 'Drop image to upload it.',\n    sbOnDrop: 'Uploading image #images_names#...',\n    sbProgress: 'Uploading #file_name#: #progress#%',\n    sbOnUploaded: 'Uploaded #image_name#',\n    sizeUnits: 'b,Kb,Mb',\n};\n\n/**\n * Errors displayed to the user, using the `errorCallback` option. Can be used for\n * customization or internationalization.\n */\nvar errorMessages = {\n    noFileGiven: 'You must select a file.',\n    typeNotAllowed: 'This image type is not allowed.',\n    fileTooLarge: 'Image #image_name# is too big (#image_size#).\\n' +\n        'Maximum file size is #image_max_size#.',\n    importError: 'Something went wrong when uploading the image #image_name#.',\n};\n\n/**\n * Interface of EasyMDE.\n */\nfunction EasyMDE(options) {\n    // Handle options parameter\n    options = options || {};\n\n    // Used later to refer to it\"s parent\n    options.parent = this;\n\n    // Check if Font Awesome needs to be auto downloaded\n    var autoDownloadFA = true;\n\n    if (options.autoDownloadFontAwesome === false) {\n        autoDownloadFA = false;\n    }\n\n    if (options.autoDownloadFontAwesome !== true) {\n        var styleSheets = document.styleSheets;\n        for (var i = 0; i < styleSheets.length; i++) {\n            if (!styleSheets[i].href)\n                continue;\n\n            if (styleSheets[i].href.indexOf('//maxcdn.bootstrapcdn.com/font-awesome/') > -1) {\n                autoDownloadFA = false;\n            }\n        }\n    }\n\n    if (autoDownloadFA) {\n        var link = document.createElement('link');\n        link.rel = 'stylesheet';\n        link.href = 'https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css';\n        document.getElementsByTagName('head')[0].appendChild(link);\n    }\n\n\n    // Find the textarea to use\n    if (options.element) {\n        this.element = options.element;\n    } else if (options.element === null) {\n        // This means that the element option was specified, but no element was found\n        console.log('EasyMDE: Error. No element was found.');\n        return;\n    }\n\n\n    // Handle toolbar\n    if (options.toolbar === undefined) {\n        // Initialize\n        options.toolbar = [];\n\n\n        // Loop over the built in buttons, to get the preferred order\n        for (var key in toolbarBuiltInButtons) {\n            if (Object.prototype.hasOwnProperty.call(toolbarBuiltInButtons, key)) {\n                if (key.indexOf('separator-') != -1) {\n                    options.toolbar.push('|');\n                }\n\n                if (toolbarBuiltInButtons[key].default === true || (options.showIcons && options.showIcons.constructor === Array && options.showIcons.indexOf(key) != -1)) {\n                    options.toolbar.push(key);\n                }\n            }\n        }\n    }\n\n    // Editor preview styling class.\n    if (!Object.prototype.hasOwnProperty.call(options, 'previewClass')) {\n        options.previewClass = 'editor-preview';\n    }\n\n    // Handle status bar\n    if (!Object.prototype.hasOwnProperty.call(options, 'status')) {\n        options.status = ['autosave', 'lines', 'words', 'cursor'];\n\n        if (options.uploadImage) {\n            options.status.unshift('upload-image');\n        }\n    }\n\n\n    // Add default preview rendering function\n    if (!options.previewRender) {\n        options.previewRender = function (plainText) {\n            // Note: \"this\" refers to the options object\n            return this.parent.markdown(plainText);\n        };\n    }\n\n\n    // Set default options for parsing config\n    options.parsingConfig = extend({\n        highlightFormatting: true, // needed for toggleCodeBlock to detect types of code\n    }, options.parsingConfig || {});\n\n\n    // Merging the insertTexts, with the given options\n    options.insertTexts = extend({}, insertTexts, options.insertTexts || {});\n\n\n    // Merging the promptTexts, with the given options\n    options.promptTexts = extend({}, promptTexts, options.promptTexts || {});\n\n\n    // Merging the blockStyles, with the given options\n    options.blockStyles = extend({}, blockStyles, options.blockStyles || {});\n\n\n    // Merging the shortcuts, with the given options\n    options.shortcuts = extend({}, shortcuts, options.shortcuts || {});\n\n    options.minHeight = options.minHeight || '300px';\n\n    options.errorCallback = options.errorCallback || function (errorMessage) {\n        alert(errorMessage);\n    };\n\n    // Import-image default configuration\n    options.uploadImage = options.uploadImage || false;\n    options.imageMaxSize = options.imageMaxSize || 2097152; // 1024 * 1024 * 2\n    options.imageAccept = options.imageAccept || 'image/png, image/jpeg';\n    options.imageTexts = extend({}, imageTexts, options.imageTexts || {});\n    options.errorMessages = extend({}, errorMessages, options.errorMessages || {});\n\n\n    // Change unique_id to uniqueId for backwards compatibility\n    if (options.autosave != undefined && options.autosave.unique_id != undefined && options.autosave.unique_id != '')\n        options.autosave.uniqueId = options.autosave.unique_id;\n\n\n    // Update this options\n    this.options = options;\n\n\n    // Auto render\n    this.render();\n\n\n    // The codemirror component is only available after rendering\n    // so, the setter for the initialValue can only run after\n    // the element has been rendered\n    if (options.initialValue && (!this.options.autosave || this.options.autosave.foundSavedValue !== true)) {\n        this.value(options.initialValue);\n    }\n\n    if (options.uploadImage) {\n        var self = this;\n\n        this.codemirror.on('dragenter', function (cm, event) {\n            self.updateStatusBar('upload-image', self.options.imageTexts.sbOnDragEnter);\n            event.stopPropagation();\n            event.preventDefault();\n        });\n        this.codemirror.on('dragend', function (cm, event) {\n            self.updateStatusBar('upload-image', self.options.imageTexts.sbInit);\n            event.stopPropagation();\n            event.preventDefault();\n        });\n        this.codemirror.on('dragleave', function (cm, event) {\n            self.updateStatusBar('upload-image', self.options.imageTexts.sbInit);\n            event.stopPropagation();\n            event.preventDefault();\n        });\n\n        this.codemirror.on('dragover', function (cm, event) {\n            self.updateStatusBar('upload-image', self.options.imageTexts.sbOnDragEnter);\n            event.stopPropagation();\n            event.preventDefault();\n        });\n\n        this.codemirror.on('drop', function (cm, event) {\n            event.stopPropagation();\n            event.preventDefault();\n            if (options.imageUploadFunction) {\n                self.uploadImagesUsingCustomFunction(options.imageUploadFunction, event.dataTransfer.files);\n            } else {\n                self.uploadImages(event.dataTransfer.files);\n            }\n        });\n\n        this.codemirror.on('paste', function (cm, event) {\n            if (options.imageUploadFunction) {\n                self.uploadImagesUsingCustomFunction(options.imageUploadFunction, event.clipboardData.files);\n            } else {\n                self.uploadImages(event.clipboardData.files);\n            }\n        });\n    }\n}\n\n/**\n * Upload asynchronously a list of images to a server.\n *\n * Can be triggered by:\n * - drag&drop;\n * - copy-paste;\n * - the browse-file window (opened when the user clicks on the *upload-image* icon).\n * @param {FileList} files The files to upload the the server.\n * @param [onSuccess] {function} see EasyMDE.prototype.uploadImage\n * @param [onError] {function} see EasyMDE.prototype.uploadImage\n */\nEasyMDE.prototype.uploadImages = function (files, onSuccess, onError) {\n    if (files.length === 0) {\n      return;\n    }\n    var names = [];\n    for (var i = 0; i < files.length; i++) {\n        names.push(files[i].name);\n        this.uploadImage(files[i], onSuccess, onError);\n    }\n    this.updateStatusBar('upload-image', this.options.imageTexts.sbOnDrop.replace('#images_names#', names.join(', ')));\n};\n\n/**\n * Upload asynchronously a list of images to a server.\n *\n * Can be triggered by:\n * - drag&drop;\n * - copy-paste;\n * - the browse-file window (opened when the user clicks on the *upload-image* icon).\n * @param imageUploadFunction {Function} The custom function to upload the image passed in options.\n * @param {FileList} files The files to upload the the server.\n */\nEasyMDE.prototype.uploadImagesUsingCustomFunction = function (imageUploadFunction, files) {\n    if (files.length === 0) {\n      return;\n    }\n    var names = [];\n    for (var i = 0; i < files.length; i++) {\n        names.push(files[i].name);\n        this.uploadImageUsingCustomFunction(imageUploadFunction, files[i]);\n    }\n    this.updateStatusBar('upload-image', this.options.imageTexts.sbOnDrop.replace('#images_names#', names.join(', ')));\n};\n\n/**\n * Update an item in the status bar.\n * @param itemName {string} The name of the item to update (ie. 'upload-image', 'autosave', etc.).\n * @param content {string} the new content of the item to write in the status bar.\n */\nEasyMDE.prototype.updateStatusBar = function (itemName, content) {\n    var matchingClasses = this.gui.statusbar.getElementsByClassName(itemName);\n    if (matchingClasses.length === 1) {\n        this.gui.statusbar.getElementsByClassName(itemName)[0].textContent = content;\n    } else if (matchingClasses.length === 0) {\n        console.log('EasyMDE: status bar item ' + itemName + ' was not found.');\n    } else {\n        console.log('EasyMDE: Several status bar items named ' + itemName + ' was found.');\n    }\n};\n\n/**\n * Default markdown render.\n */\nEasyMDE.prototype.markdown = function (text) {\n    if (marked) {\n        // Initialize\n        var markedOptions;\n        if (this.options && this.options.renderingConfig && this.options.renderingConfig.markedOptions) {\n            markedOptions = this.options.renderingConfig.markedOptions;\n        } else {\n            markedOptions = {};\n        }\n\n        // Update options\n        if (this.options && this.options.renderingConfig && this.options.renderingConfig.singleLineBreaks === false) {\n            markedOptions.breaks = false;\n        } else {\n            markedOptions.breaks = true;\n        }\n\n        if (this.options && this.options.renderingConfig && this.options.renderingConfig.codeSyntaxHighlighting === true) {\n\n            /* Get HLJS from config or window */\n            var hljs = this.options.renderingConfig.hljs || window.hljs;\n\n            /* Check if HLJS loaded */\n            if (hljs) {\n                markedOptions.highlight = function (code) {\n                    return hljs.highlightAuto(code).value;\n                };\n            }\n        }\n\n        // Set options\n        marked.setOptions(markedOptions);\n\n        // Convert the markdown to HTML\n        var htmlText = marked(text);\n\n        // Edit the HTML anchors to add 'target=\"_blank\"' by default.\n        htmlText = addAnchorTargetBlank(htmlText);\n\n        return htmlText;\n    }\n};\n\n/**\n * Render editor to the given element.\n */\nEasyMDE.prototype.render = function (el) {\n    if (!el) {\n        el = this.element || document.getElementsByTagName('textarea')[0];\n    }\n\n    if (this._rendered && this._rendered === el) {\n        // Already rendered.\n        return;\n    }\n\n    this.element = el;\n    var options = this.options;\n\n    var self = this;\n    var keyMaps = {};\n\n    for (var key in options.shortcuts) {\n        // null stands for \"do not bind this command\"\n        if (options.shortcuts[key] !== null && bindings[key] !== null) {\n            (function (key) {\n                keyMaps[fixShortcut(options.shortcuts[key])] = function () {\n                    var action = bindings[key];\n                    if (typeof action === 'function') {\n                        action(self);\n                    } else if (typeof action === 'string') {\n                        window.open(action, '_blank');\n                    }\n                };\n            })(key);\n        }\n    }\n\n    keyMaps['Enter'] = 'newlineAndIndentContinueMarkdownList';\n    keyMaps['Tab'] = 'tabAndIndentMarkdownList';\n    keyMaps['Shift-Tab'] = 'shiftTabAndUnindentMarkdownList';\n    keyMaps['Esc'] = function (cm) {\n        if (cm.getOption('fullScreen')) toggleFullScreen(self);\n    };\n\n    document.addEventListener('keydown', function (e) {\n        e = e || window.event;\n\n        if (e.keyCode == 27) {\n            if (self.codemirror.getOption('fullScreen')) toggleFullScreen(self);\n        }\n    }, false);\n\n    var mode, backdrop;\n    if (options.spellChecker !== false) {\n        mode = 'spell-checker';\n        backdrop = options.parsingConfig;\n        backdrop.name = 'gfm';\n        backdrop.gitHubSpice = false;\n\n        CodeMirrorSpellChecker({\n            codeMirrorInstance: CodeMirror,\n        });\n    } else {\n        mode = options.parsingConfig;\n        mode.name = 'gfm';\n        mode.gitHubSpice = false;\n    }\n\n    // eslint-disable-next-line no-unused-vars\n    function configureMouse(cm, repeat, event) {\n        return {\n            addNew: false,\n        };\n    }\n\n    this.codemirror = CodeMirror.fromTextArea(el, {\n        mode: mode,\n        backdrop: backdrop,\n        theme: (options.theme != undefined) ? options.theme : 'easymde',\n        tabSize: (options.tabSize != undefined) ? options.tabSize : 2,\n        indentUnit: (options.tabSize != undefined) ? options.tabSize : 2,\n        indentWithTabs: (options.indentWithTabs === false) ? false : true,\n        lineNumbers: false,\n        autofocus: (options.autofocus === true) ? true : false,\n        extraKeys: keyMaps,\n        lineWrapping: (options.lineWrapping === false) ? false : true,\n        allowDropFileTypes: ['text/plain'],\n        placeholder: options.placeholder || el.getAttribute('placeholder') || '',\n        styleSelectedText: (options.styleSelectedText != undefined) ? options.styleSelectedText : !isMobile(),\n        configureMouse: configureMouse,\n    });\n\n    this.codemirror.getScrollerElement().style.minHeight = options.minHeight;\n\n    if (options.forceSync === true) {\n        var cm = this.codemirror;\n        cm.on('change', function () {\n            cm.save();\n        });\n    }\n\n    this.gui = {};\n\n    if (options.toolbar !== false) {\n        this.gui.toolbar = this.createToolbar();\n    }\n    if (options.status !== false) {\n        this.gui.statusbar = this.createStatusbar();\n    }\n    if (options.autosave != undefined && options.autosave.enabled === true) {\n        this.autosave();\n    }\n\n    this.gui.sideBySide = this.createSideBySide();\n\n    this._rendered = this.element;\n\n\n    // Fixes CodeMirror bug (#344)\n    var temp_cm = this.codemirror;\n    setTimeout(function () {\n        temp_cm.refresh();\n    }.bind(temp_cm), 0);\n};\n\n// Safari, in Private Browsing Mode, looks like it supports localStorage but all calls to setItem throw QuotaExceededError. We're going to detect this and set a variable accordingly.\nfunction isLocalStorageAvailable() {\n    if (typeof localStorage === 'object') {\n        try {\n            localStorage.setItem('smde_localStorage', 1);\n            localStorage.removeItem('smde_localStorage');\n        } catch (e) {\n            return false;\n        }\n    } else {\n        return false;\n    }\n\n    return true;\n}\n\nEasyMDE.prototype.autosave = function () {\n    if (isLocalStorageAvailable()) {\n        var easyMDE = this;\n\n        if (this.options.autosave.uniqueId == undefined || this.options.autosave.uniqueId == '') {\n            console.log('EasyMDE: You must set a uniqueId to use the autosave feature');\n            return;\n        }\n\n        if (this.options.autosave.binded !== true) {\n            if (easyMDE.element.form != null && easyMDE.element.form != undefined) {\n                easyMDE.element.form.addEventListener('submit', function () {\n                    clearTimeout(easyMDE.autosaveTimeoutId);\n                    easyMDE.autosaveTimeoutId = undefined;\n\n                    localStorage.removeItem('smde_' + easyMDE.options.autosave.uniqueId);\n\n                    // Restart autosaving in case the submit will be cancelled down the line\n                    setTimeout(function () {\n                        easyMDE.autosave();\n                    }, easyMDE.options.autosave.delay || 10000);\n                });\n            }\n\n            this.options.autosave.binded = true;\n        }\n\n        if (this.options.autosave.loaded !== true) {\n            if (typeof localStorage.getItem('smde_' + this.options.autosave.uniqueId) == 'string' && localStorage.getItem('smde_' + this.options.autosave.uniqueId) != '') {\n                this.codemirror.setValue(localStorage.getItem('smde_' + this.options.autosave.uniqueId));\n                this.options.autosave.foundSavedValue = true;\n            }\n\n            this.options.autosave.loaded = true;\n        }\n\n        localStorage.setItem('smde_' + this.options.autosave.uniqueId, easyMDE.value());\n\n        var el = document.getElementById('autosaved');\n        if (el != null && el != undefined && el != '') {\n            var d = new Date();\n            var hh = d.getHours();\n            var m = d.getMinutes();\n            var dd = 'am';\n            var h = hh;\n            if (h >= 12) {\n                h = hh - 12;\n                dd = 'pm';\n            }\n            if (h == 0) {\n                h = 12;\n            }\n            m = m < 10 ? '0' + m : m;\n\n            el.innerHTML = 'Autosaved: ' + h + ':' + m + ' ' + dd;\n        }\n\n        this.autosaveTimeoutId = setTimeout(function () {\n            easyMDE.autosave();\n        }, this.options.autosave.delay || 10000);\n    } else {\n        console.log('EasyMDE: localStorage not available, cannot autosave');\n    }\n};\n\nEasyMDE.prototype.clearAutosavedValue = function () {\n    if (isLocalStorageAvailable()) {\n        if (this.options.autosave == undefined || this.options.autosave.uniqueId == undefined || this.options.autosave.uniqueId == '') {\n            console.log('EasyMDE: You must set a uniqueId to clear the autosave value');\n            return;\n        }\n\n        localStorage.removeItem('smde_' + this.options.autosave.uniqueId);\n    } else {\n        console.log('EasyMDE: localStorage not available, cannot autosave');\n    }\n};\n\n/**\n * Open the browse-file window to upload an image to a server.\n * @param [onSuccess] {function} see EasyMDE.prototype.uploadImage\n * @param [onError] {function} see EasyMDE.prototype.uploadImage\n */\nEasyMDE.prototype.openBrowseFileWindow = function (onSuccess, onError) {\n    var self = this;\n    var imageInput = this.gui.toolbar.getElementsByClassName('imageInput')[0];\n    imageInput.click(); //dispatchEvent(new MouseEvent('click'));  // replaced with click() for IE11 compatibility.\n    function onChange(event) {\n        if (self.options.imageUploadFunction) {\n          self.uploadImagesUsingCustomFunction(self.options.imageUploadFunction, event.target.files);\n        } else {\n          self.uploadImages(event.target.files, onSuccess, onError);\n        }\n        imageInput.removeEventListener('change', onChange);\n    }\n\n    imageInput.addEventListener('change', onChange);\n};\n\n/**\n * Upload an image to the server.\n *\n * @param file {File} The image to upload, as a HTML5 File object (https://developer.mozilla.org/en-US/docs/Web/API/File)\n * @param [onSuccess] {function} A callback function to execute after the image has been successfully uploaded, with one parameter:\n * - url (string): The URL of the uploaded image.\n * @param [onError] {function} A callback function to execute when the image upload fails, with one parameter:\n * - error (string): the detailed error to display to the user (based on messages from options.errorMessages).\n */\nEasyMDE.prototype.uploadImage = function (file, onSuccess, onError) {\n    var self = this;\n    onSuccess = onSuccess || function onSuccess(imageUrl) {\n        afterImageUploaded(self, imageUrl);\n    };\n\n    function onErrorSup(errorMessage) {\n        // show error on status bar and reset after 10000ms\n        self.updateStatusBar('upload-image', errorMessage);\n\n        setTimeout(function () {\n            self.updateStatusBar('upload-image', self.options.imageTexts.sbInit);\n        }, 10000);\n\n        // run custom error handler\n        if (onError && typeof onError === 'function') {\n            onError(errorMessage);\n        }\n        // run error handler from options, this alerts the message.\n        self.options.errorCallback(errorMessage);\n    }\n\n    function fillErrorMessage(errorMessage) {\n        var units = self.options.imageTexts.sizeUnits.split(',');\n        return errorMessage\n            .replace('#image_name#', file.name)\n            .replace('#image_size#', humanFileSize(file.size, units))\n            .replace('#image_max_size#', humanFileSize(self.options.imageMaxSize, units));\n    }\n\n    if (file.size > this.options.imageMaxSize) {\n        onErrorSup(fillErrorMessage(this.options.errorMessages.fileTooLarge));\n        return;\n    }\n\n    var formData = new FormData();\n    formData.append('image', file);\n\n    // insert CSRF token if provided in config.\n    if (self.options.imageCSRFToken) {\n        formData.append('csrfmiddlewaretoken', self.options.imageCSRFToken);\n    }\n    var request = new XMLHttpRequest();\n    request.upload.onprogress = function (event) {\n        if (event.lengthComputable) {\n            var progress = '' + Math.round((event.loaded * 100) / event.total);\n            self.updateStatusBar('upload-image', self.options.imageTexts.sbProgress.replace('#file_name#', file.name).replace('#progress#', progress));\n        }\n    };\n    request.open('POST', this.options.imageUploadEndpoint);\n\n    request.onload = function () {\n        try {\n            var response = JSON.parse(this.responseText);\n        } catch (error) {\n            console.error('EasyMDE: The server did not return a valid json.');\n            onErrorSup(fillErrorMessage(self.options.errorMessages.importError));\n            return;\n        }\n        if (this.status === 200 && response && !response.error && response.data && response.data.filePath) {\n            onSuccess(window.location.origin + '/' + response.data.filePath);\n        } else {\n            if (response.error && response.error in self.options.errorMessages) {  // preformatted error message\n                onErrorSup(fillErrorMessage(self.options.errorMessages[response.error]));\n            } else if (response.error) {  // server side generated error message\n                onErrorSup(fillErrorMessage(response.error));\n            } else {  //unknown error\n                console.error('EasyMDE: Received an unexpected response after uploading the image.'\n                    + this.status + ' (' + this.statusText + ')');\n                onErrorSup(fillErrorMessage(self.options.errorMessages.importError));\n            }\n        }\n    };\n\n    request.onerror = function (event) {\n        console.error('EasyMDE: An unexpected error occurred when trying to upload the image.'\n            + event.target.status + ' (' + event.target.statusText + ')');\n        onErrorSup(self.options.errorMessages.importError);\n    };\n\n    request.send(formData);\n\n};\n\n/**\n * Upload an image to the server using a custom upload function.\n *\n * @param imageUploadFunction {Function} The custom function to upload the image passed in options\n * @param file {File} The image to upload, as a HTML5 File object (https://developer.mozilla.org/en-US/docs/Web/API/File).\n */\nEasyMDE.prototype.uploadImageUsingCustomFunction = function(imageUploadFunction, file) {\n    var self = this;\n    function onSuccess(imageUrl) {\n        afterImageUploaded(self, imageUrl);\n    }\n\n    function onError(errorMessage) {\n        var filledErrorMessage = fillErrorMessage(errorMessage);\n        // show error on status bar and reset after 10000ms\n        self.updateStatusBar('upload-image', filledErrorMessage);\n\n        setTimeout(function () {\n            self.updateStatusBar('upload-image', self.options.imageTexts.sbInit);\n        }, 10000);\n\n        // run error handler from options, this alerts the message.\n        self.options.errorCallback(filledErrorMessage);\n    }\n\n    function fillErrorMessage(errorMessage) {\n        var units = self.options.imageTexts.sizeUnits.split(',');\n        return errorMessage\n            .replace('#image_name#', file.name)\n            .replace('#image_size#', humanFileSize(file.size, units))\n            .replace('#image_max_size#', humanFileSize(self.options.imageMaxSize, units));\n    }\n\n    imageUploadFunction(file, onSuccess, onError);\n};\n\nEasyMDE.prototype.createSideBySide = function () {\n    var cm = this.codemirror;\n    var wrapper = cm.getWrapperElement();\n    var preview = wrapper.nextSibling;\n\n    if (!preview || !/editor-preview-side/.test(preview.className)) {\n        preview = document.createElement('div');\n        preview.className = 'editor-preview-side';\n\n        if (this.options.previewClass) {\n\n            if (Array.isArray(this.options.previewClass)) {\n                for (var i = 0; i < this.options.previewClass.length; i++) {\n                    preview.className += (' ' + this.options.previewClass[i]);\n                }\n\n            } else if (typeof this.options.previewClass === 'string') {\n                preview.className += (' ' + this.options.previewClass);\n            }\n        }\n\n        wrapper.parentNode.insertBefore(preview, wrapper.nextSibling);\n    }\n\n    if (this.options.syncSideBySidePreviewScroll === false) return preview;\n    // Syncs scroll  editor -> preview\n    var cScroll = false;\n    var pScroll = false;\n    cm.on('scroll', function (v) {\n        if (cScroll) {\n            cScroll = false;\n            return;\n        }\n        pScroll = true;\n        var height = v.getScrollInfo().height - v.getScrollInfo().clientHeight;\n        var ratio = parseFloat(v.getScrollInfo().top) / height;\n        var move = (preview.scrollHeight - preview.clientHeight) * ratio;\n        preview.scrollTop = move;\n    });\n\n    // Syncs scroll  preview -> editor\n    preview.onscroll = function () {\n        if (pScroll) {\n            pScroll = false;\n            return;\n        }\n        cScroll = true;\n        var height = preview.scrollHeight - preview.clientHeight;\n        var ratio = parseFloat(preview.scrollTop) / height;\n        var move = (cm.getScrollInfo().height - cm.getScrollInfo().clientHeight) * ratio;\n        cm.scrollTo(0, move);\n    };\n    return preview;\n};\n\nEasyMDE.prototype.createToolbar = function (items) {\n    items = items || this.options.toolbar;\n\n    if (!items || items.length === 0) {\n        return;\n    }\n    var i;\n    for (i = 0; i < items.length; i++) {\n        if (toolbarBuiltInButtons[items[i]] != undefined) {\n            items[i] = toolbarBuiltInButtons[items[i]];\n        }\n    }\n\n    var bar = document.createElement('div');\n    bar.className = 'editor-toolbar';\n\n    var self = this;\n\n    var toolbarData = {};\n    self.toolbar = items;\n\n    for (i = 0; i < items.length; i++) {\n        if (items[i].name == 'guide' && self.options.toolbarGuideIcon === false)\n            continue;\n\n        if (self.options.hideIcons && self.options.hideIcons.indexOf(items[i].name) != -1)\n            continue;\n\n        // Fullscreen does not work well on mobile devices (even tablets)\n        // In the future, hopefully this can be resolved\n        if ((items[i].name == 'fullscreen' || items[i].name == 'side-by-side') && isMobile())\n            continue;\n\n\n        // Don't include trailing separators\n        if (items[i] === '|') {\n            var nonSeparatorIconsFollow = false;\n\n            for (var x = (i + 1); x < items.length; x++) {\n                if (items[x] !== '|' && (!self.options.hideIcons || self.options.hideIcons.indexOf(items[x].name) == -1)) {\n                    nonSeparatorIconsFollow = true;\n                }\n            }\n\n            if (!nonSeparatorIconsFollow)\n                continue;\n        }\n\n\n        // Create the icon and append to the toolbar\n        (function (item) {\n            var el;\n            if (item === '|') {\n                el = createSep();\n            } else {\n                el = createToolbarButton(item, self.options.toolbarTips, self.options.shortcuts);\n            }\n\n            // bind events, special for info\n            if (item.action) {\n                if (typeof item.action === 'function') {\n                    el.onclick = function (e) {\n                        e.preventDefault();\n                        item.action(self);\n                    };\n                } else if (typeof item.action === 'string') {\n                    el.onclick = function (e) {\n                        e.preventDefault();\n                        window.open(item.action, '_blank');\n                    };\n                }\n            }\n\n            toolbarData[item.name || item] = el;\n            bar.appendChild(el);\n\n            // Create the input element (ie. <input type='file'>), used among\n            // with the 'import-image' icon to open the browse-file window.\n            if (item.name === 'upload-image') {\n                var imageInput = document.createElement('input');\n                imageInput.className = 'imageInput';\n                imageInput.type = 'file';\n                imageInput.multiple = true;\n                imageInput.name = 'image';\n                imageInput.accept = self.options.imageAccept;\n                imageInput.style.display = 'none';\n                imageInput.style.opacity = 0;\n                bar.appendChild(imageInput);\n            }\n        })(items[i]);\n    }\n\n    self.toolbarElements = toolbarData;\n\n    var cm = this.codemirror;\n    cm.on('cursorActivity', function () {\n        var stat = getState(cm);\n\n        for (var key in toolbarData) {\n            (function (key) {\n                var el = toolbarData[key];\n                if (stat[key]) {\n                    el.className += ' active';\n                } else if (key != 'fullscreen' && key != 'side-by-side') {\n                    el.className = el.className.replace(/\\s*active\\s*/g, '');\n                }\n            })(key);\n        }\n    });\n\n    var cmWrapper = cm.getWrapperElement();\n    cmWrapper.parentNode.insertBefore(bar, cmWrapper);\n    return bar;\n};\n\nEasyMDE.prototype.createStatusbar = function (status) {\n    // Initialize\n    status = status || this.options.status;\n    var options = this.options;\n    var cm = this.codemirror;\n\n    // Make sure the status variable is valid\n    if (!status || status.length === 0) {\n        return;\n    }\n\n    // Set up the built-in items\n    var items = [];\n    var i, onUpdate, defaultValue;\n\n    for (i = 0; i < status.length; i++) {\n        // Reset some values\n        onUpdate = undefined;\n        defaultValue = undefined;\n\n\n        // Handle if custom or not\n        if (typeof status[i] === 'object') {\n            items.push({\n                className: status[i].className,\n                defaultValue: status[i].defaultValue,\n                onUpdate: status[i].onUpdate,\n            });\n        } else {\n            var name = status[i];\n\n            if (name === 'words') {\n                defaultValue = function (el) {\n                    el.innerHTML = wordCount(cm.getValue());\n                };\n                onUpdate = function (el) {\n                    el.innerHTML = wordCount(cm.getValue());\n                };\n            } else if (name === 'lines') {\n                defaultValue = function (el) {\n                    el.innerHTML = cm.lineCount();\n                };\n                onUpdate = function (el) {\n                    el.innerHTML = cm.lineCount();\n                };\n            } else if (name === 'cursor') {\n                defaultValue = function (el) {\n                    el.innerHTML = '0:0';\n                };\n                onUpdate = function (el) {\n                    var pos = cm.getCursor();\n                    el.innerHTML = pos.line + ':' + pos.ch;\n                };\n            } else if (name === 'autosave') {\n                defaultValue = function (el) {\n                    if (options.autosave != undefined && options.autosave.enabled === true) {\n                        el.setAttribute('id', 'autosaved');\n                    }\n                };\n            } else if (name === 'upload-image') {\n                defaultValue = function (el) {\n                    el.innerHTML = options.imageTexts.sbInit;\n                };\n            }\n\n            items.push({\n                className: name,\n                defaultValue: defaultValue,\n                onUpdate: onUpdate,\n            });\n        }\n    }\n\n\n    // Create element for the status bar\n    var bar = document.createElement('div');\n    bar.className = 'editor-statusbar';\n\n\n    // Create a new span for each item\n    for (i = 0; i < items.length; i++) {\n        // Store in temporary variable\n        var item = items[i];\n\n\n        // Create span element\n        var el = document.createElement('span');\n        el.className = item.className;\n\n\n        // Ensure the defaultValue is a function\n        if (typeof item.defaultValue === 'function') {\n            item.defaultValue(el);\n        }\n\n\n        // Ensure the onUpdate is a function\n        if (typeof item.onUpdate === 'function') {\n            // Create a closure around the span of the current action, then execute the onUpdate handler\n            this.codemirror.on('update', (function (el, item) {\n                return function () {\n                    item.onUpdate(el);\n                };\n            }(el, item)));\n        }\n\n\n        // Append the item to the status bar\n        bar.appendChild(el);\n    }\n\n\n    // Insert the status bar into the DOM\n    var cmWrapper = this.codemirror.getWrapperElement();\n    cmWrapper.parentNode.insertBefore(bar, cmWrapper.nextSibling);\n    return bar;\n};\n\n/**\n * Get or set the text content.\n */\nEasyMDE.prototype.value = function (val) {\n    var cm = this.codemirror;\n    if (val === undefined) {\n        return cm.getValue();\n    } else {\n        cm.getDoc().setValue(val);\n        if (this.isPreviewActive()) {\n            var wrapper = cm.getWrapperElement();\n            var preview = wrapper.lastChild;\n            preview.innerHTML = this.options.previewRender(val, preview);\n        }\n        return this;\n    }\n};\n\n\n/**\n * Bind static methods for exports.\n */\nEasyMDE.toggleBold = toggleBold;\nEasyMDE.toggleItalic = toggleItalic;\nEasyMDE.toggleStrikethrough = toggleStrikethrough;\nEasyMDE.toggleBlockquote = toggleBlockquote;\nEasyMDE.toggleHeadingSmaller = toggleHeadingSmaller;\nEasyMDE.toggleHeadingBigger = toggleHeadingBigger;\nEasyMDE.toggleHeading1 = toggleHeading1;\nEasyMDE.toggleHeading2 = toggleHeading2;\nEasyMDE.toggleHeading3 = toggleHeading3;\nEasyMDE.toggleCodeBlock = toggleCodeBlock;\nEasyMDE.toggleUnorderedList = toggleUnorderedList;\nEasyMDE.toggleOrderedList = toggleOrderedList;\nEasyMDE.cleanBlock = cleanBlock;\nEasyMDE.drawLink = drawLink;\nEasyMDE.drawImage = drawImage;\nEasyMDE.drawTable = drawTable;\nEasyMDE.drawHorizontalRule = drawHorizontalRule;\nEasyMDE.undo = undo;\nEasyMDE.redo = redo;\nEasyMDE.togglePreview = togglePreview;\nEasyMDE.toggleSideBySide = toggleSideBySide;\nEasyMDE.toggleFullScreen = toggleFullScreen;\n\n/**\n * Bind instance methods for exports.\n */\nEasyMDE.prototype.toggleBold = function () {\n    toggleBold(this);\n};\nEasyMDE.prototype.toggleItalic = function () {\n    toggleItalic(this);\n};\nEasyMDE.prototype.toggleStrikethrough = function () {\n    toggleStrikethrough(this);\n};\nEasyMDE.prototype.toggleBlockquote = function () {\n    toggleBlockquote(this);\n};\nEasyMDE.prototype.toggleHeadingSmaller = function () {\n    toggleHeadingSmaller(this);\n};\nEasyMDE.prototype.toggleHeadingBigger = function () {\n    toggleHeadingBigger(this);\n};\nEasyMDE.prototype.toggleHeading1 = function () {\n    toggleHeading1(this);\n};\nEasyMDE.prototype.toggleHeading2 = function () {\n    toggleHeading2(this);\n};\nEasyMDE.prototype.toggleHeading3 = function () {\n    toggleHeading3(this);\n};\nEasyMDE.prototype.toggleCodeBlock = function () {\n    toggleCodeBlock(this);\n};\nEasyMDE.prototype.toggleUnorderedList = function () {\n    toggleUnorderedList(this);\n};\nEasyMDE.prototype.toggleOrderedList = function () {\n    toggleOrderedList(this);\n};\nEasyMDE.prototype.cleanBlock = function () {\n    cleanBlock(this);\n};\nEasyMDE.prototype.drawLink = function () {\n    drawLink(this);\n};\nEasyMDE.prototype.drawImage = function () {\n    drawImage(this);\n};\nEasyMDE.prototype.drawTable = function () {\n    drawTable(this);\n};\nEasyMDE.prototype.drawHorizontalRule = function () {\n    drawHorizontalRule(this);\n};\nEasyMDE.prototype.undo = function () {\n    undo(this);\n};\nEasyMDE.prototype.redo = function () {\n    redo(this);\n};\nEasyMDE.prototype.togglePreview = function () {\n    togglePreview(this);\n};\nEasyMDE.prototype.toggleSideBySide = function () {\n    toggleSideBySide(this);\n};\nEasyMDE.prototype.toggleFullScreen = function () {\n    toggleFullScreen(this);\n};\n\nEasyMDE.prototype.isPreviewActive = function () {\n    var cm = this.codemirror;\n    var wrapper = cm.getWrapperElement();\n    var preview = wrapper.lastChild;\n\n    return /editor-preview-active/.test(preview.className);\n};\n\nEasyMDE.prototype.isSideBySideActive = function () {\n    var cm = this.codemirror;\n    var wrapper = cm.getWrapperElement();\n    var preview = wrapper.nextSibling;\n\n    return /editor-preview-active-side/.test(preview.className);\n};\n\nEasyMDE.prototype.isFullscreenActive = function () {\n    var cm = this.codemirror;\n\n    return cm.getOption('fullScreen');\n};\n\nEasyMDE.prototype.getState = function () {\n    var cm = this.codemirror;\n\n    return getState(cm);\n};\n\nEasyMDE.prototype.toTextArea = function () {\n    var cm = this.codemirror;\n    var wrapper = cm.getWrapperElement();\n\n    if (wrapper.parentNode) {\n        if (this.gui.toolbar) {\n            wrapper.parentNode.removeChild(this.gui.toolbar);\n        }\n        if (this.gui.statusbar) {\n            wrapper.parentNode.removeChild(this.gui.statusbar);\n        }\n        if (this.gui.sideBySide) {\n            wrapper.parentNode.removeChild(this.gui.sideBySide);\n        }\n    }\n\n    cm.toTextArea();\n\n    if (this.autosaveTimeoutId) {\n        clearTimeout(this.autosaveTimeoutId);\n        this.autosaveTimeoutId = undefined;\n        this.clearAutosavedValue();\n    }\n};\n\nmodule.exports = EasyMDE;\n"]},"metadata":{},"sourceType":"script"}